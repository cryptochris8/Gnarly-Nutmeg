<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HySports Soccer - Phase 1 Enhanced</title>
</head>
<body>

<style>
  @import url('{{CDN_ASSETS_URL}}/ui/fonts/trebuchet-ms.css');

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Trebuchet MS", "Arial", sans-serif;
    background: transparent;
    overflow: hidden;
    user-select: none;
    cursor: default;
    pointer-events: auto; /* Ensure UI can receive pointer events */
  }

  /* ===== ENHANCED BUTTON STYLES TO PREVENT CURSOR ISSUES ===== */
  button, .btn, .team-btn, .game-mode-btn, .control-btn, .how-to-play-btn, .tab-button {
    cursor: pointer !important;
    user-select: none !important;
    -webkit-user-select: none !important;
    -moz-user-select: none !important;
    -ms-user-select: none !important;
    pointer-events: auto !important;
    outline: none !important;
    -webkit-tap-highlight-color: transparent !important;
    /* Don't override background and border for specific button types that need styling */
  }

  button:focus, .btn:focus, .team-btn:focus, .game-mode-btn:focus, .control-btn:focus, .how-to-play-btn:focus, .tab-button:focus {
    outline: none !important;
    box-shadow: none !important;
  }

  button:active, .btn:active, .team-btn:active, .game-mode-btn:active, .control-btn:active, .how-to-play-btn:active, .tab-button:active {
    transform: scale(0.98) !important;
    transition: transform 0.1s ease !important;
  }

  /* Ensure UI container doesn't interfere with button clicks */
  #ui-container, .instructions-panel, .team-selection, .game-mode-selection {
    pointer-events: auto !important;
  }

  /* Ensure specific button types maintain their styling while being clickable */
  .team-btn, .game-mode-btn {
    border: 2px solid !important; /* Keep borders for these buttons */
  }

  /* ===== PHASE 1: ENHANCED SCORE DISPLAY ===== */
  .score-time-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 20px;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(20, 20, 20, 0.9));
    border-radius: 15px;
    padding: 15px 25px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    z-index: 1000;
  }

  .team-banner {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 15px;
    border-radius: 10px;
    min-width: 80px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .team-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .team-banner.red {
    background: linear-gradient(135deg, #ff4444, #cc3333);
    border: 2px solid #ff6666;
  }

  .team-banner.blue {
    background: linear-gradient(135deg, #4444ff, #3333cc);
    border: 2px solid #6666ff;
  }

  .team-banner:hover::before {
    left: 100%;
  }

  .team-name {
    font-size: 14px;
    font-weight: bold;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 5px;
  }

  .team-score {
    font-size: 28px;
    font-weight: bold;
    color: #ffffff !important;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 10px rgba(255, 255, 255, 0.5);
    transition: all 0.3s ease;
    min-height: 35px;
    display: flex !important;
    align-items: center;
    justify-content: center;
    opacity: 1 !important;
    visibility: visible !important;
    z-index: 10;
  }

  /* ===== ENHANCED TIMER DISPLAY ===== */
  .time-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 20px;
  }

  .phase-indicator {
    font-size: 12px;
    font-weight: bold;
    padding: 4px 8px;
    border-radius: 12px;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
  }

  .phase-indicator.waiting {
    background: #666666;
    color: #ffffff;
  }

  .phase-indicator.starting {
    background: #FFA500;
    color: #ffffff;
    animation: pulse 1s infinite;
  }

  .phase-indicator.playing {
    background: #00AA00;
    color: #ffffff;
  }

  .phase-indicator.overtime {
    background: #FF6600;
    color: #ffffff;
    animation: pulse 0.5s infinite;
  }

  .phase-indicator.goal {
    background: #FFD700;
    color: #000000;
    animation: celebration 0.5s infinite;
  }

  .phase-indicator.finished {
    background: #AA0000;
    color: #ffffff;
  }

  .time-label {
    font-size: 18px;
    font-weight: bold;
    color: #ffffff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  /* ===== STATISTICS PANEL ===== */
  .stats-panel {
    position: fixed;
    top: 100px;
    right: 20px;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(20, 20, 20, 0.9));
    border-radius: 15px;
    padding: 20px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    min-width: 250px;
    transition: all 0.3s ease;
    z-index: 999;
  }

  .stats-panel.hidden {
    transform: translateX(100%);
    opacity: 0;
  }

  .stats-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  }

  .stats-title {
    font-size: 16px;
    font-weight: bold;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding: 8px 0;
  }

  .stat-label {
    font-size: 14px;
    color: #cccccc;
    font-weight: 500;
  }

  .stat-values {
    display: flex;
    gap: 15px;
    align-items: center;
  }

  .stat-value {
    font-size: 16px;
    font-weight: bold;
    color: #ffffff;
    min-width: 30px;
    text-align: center;
  }

  .stat-value.red {
    color: #ff6666;
  }

  .stat-value.blue {
    color: #6666ff;
  }

  .possession-container {
    margin: 15px 0;
  }

  .possession-bar {
    width: 100%;
    height: 8px;
    background: linear-gradient(to right, #ff4444, #4444ff);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
  }

  .possession-bar-fill {
    height: 100%;
    background: #ff4444;
    transition: width 0.5s ease;
    border-radius: 4px;
  }

  .possession-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
    font-size: 12px;
    color: #cccccc;
  }

  /* ===== POWER-UP PANEL (ARCADE MODE ONLY) ===== */
  .powerup-panel {
    position: fixed;
    top: 100px;
    left: 20px;
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.9), rgba(255, 140, 0, 0.9));
    border-radius: 15px;
    padding: 20px;
    border: 2px solid rgba(255, 215, 0, 0.6);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(255, 102, 0, 0.4);
    min-width: 220px;
    transition: all 0.3s ease;
    z-index: 998;
  }

  .powerup-panel.hidden {
    transform: translateX(-100%);
    opacity: 0;
  }

  .powerup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  }

  .powerup-title {
    font-size: 16px;
    font-weight: bold;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .powerup-active {
    background: rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 10px;
    border: 1px solid rgba(255, 215, 0, 0.4);
  }

  .powerup-name {
    font-size: 14px;
    font-weight: bold;
    color: #FFD700;
    margin-bottom: 5px;
  }

  .powerup-description {
    font-size: 12px;
    color: #ffffff;
    opacity: 0.9;
    line-height: 1.3;
  }

  .powerup-cooldown {
    font-size: 11px;
    color: #ffcccc;
    margin-top: 5px;
    font-style: italic;
  }

  .powerup-instructions {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .powerup-key {
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 12px;
    font-weight: bold;
    color: #ffffff;
    margin-right: 5px;
  }

  /* ===== CONTROL BUTTONS ===== */
  .control-buttons {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 1001;
  }

  .control-btn {
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    color: #ffffff;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .control-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.6);
    transform: scale(1.1);
  }

  .instructions-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, rgba(20, 20, 20, 0.95), rgba(40, 40, 40, 0.95));
    border: 3px solid #ffffff;
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    color: #ffffff;
    font-family: "Trebuchet MS", "Arial", sans-serif;
    z-index: 1000;
    width: 90vw;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    transition: all 0.3s ease-in-out;
    backdrop-filter: blur(15px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }

  .instructions-panel.hidden {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
    pointer-events: none;
    display: none;
  }

  .title-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-bottom: 30px;
    gap: 12px;
  }

  .title-logo {
    width: min(280px, 40vw);
    height: min(280px, 40vw);
    object-fit: contain;
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.6));
  }

  .how-to-play-container {
    position: relative;
    margin-bottom: 30px;
  }

  .how-to-play-btn {
    background: linear-gradient(135deg, rgba(60, 60, 60, 0.8), rgba(80, 80, 80, 0.8));
    border: 2px solid #666;
    border-radius: 12px;
    color: white;
    padding: 12px 24px;
    cursor: pointer !important;
    font-size: 16px;
    transition: all 0.3s ease;
    font-weight: bold;
    backdrop-filter: blur(10px);
    pointer-events: auto;
  }

  .how-to-play-btn:hover {
    border-color: #fff;
    background: linear-gradient(135deg, rgba(80, 80, 80, 0.9), rgba(100, 100, 100, 0.9));
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  }

  .how-to-play-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(20, 20, 20, 0.95);
    border: 2px solid #ffffff;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    min-width: 400px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 1001;
  }

  .how-to-play-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 10px solid transparent;
    border-top-color: #ffffff;
  }

  .how-to-play-tooltip::before {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 8px solid transparent;
    border-top-color: rgba(20, 20, 20, 0.95);
    z-index: 1;
  }

  .how-to-play-btn:hover .how-to-play-tooltip {
    opacity: 1;
    visibility: visible;
  }

  .how-to-play-tooltip p {
    margin: 6px 0;
    font-size: 14px;
    line-height: 1.4;
    color: #ffffff;
    text-align: left;
  }

  .team-selection {
    display: flex;
    gap: 24px;
    justify-content: center;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  .team-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    min-width: 140px;
  }

  .team-btn {
    padding: 16px 32px;
    border: 3px solid transparent;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-width: 140px;
    position: relative;
    overflow: hidden;
  }

  .team-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s ease;
  }

  .team-btn:hover::before {
    left: 100%;
  }

  .team-btn.red {
    background: linear-gradient(135deg, #ff4444, #cc3333);
    color: #ffffff;
    border-color: #ff6666;
  }

  .team-btn.red:hover {
    background: linear-gradient(135deg, #ff6666, #ff4444);
    border-color: #ffffff;
    box-shadow: 0 0 20px rgba(255, 68, 68, 0.6);
    transform: translateY(-2px) scale(1.05);
  }

  .team-btn.red.selected {
    border-color: #ffffff;
    box-shadow: 0 0 25px rgba(255, 68, 68, 0.8);
    transform: translateY(-2px) scale(1.05);
  }

  .team-btn.blue {
    background: linear-gradient(135deg, #4444ff, #3333cc);
    color: #ffffff;
    border-color: #6666ff;
  }

  .team-btn.blue:hover {
    background: linear-gradient(135deg, #6666ff, #4444ff);
    border-color: #ffffff;
    box-shadow: 0 0 20px rgba(68, 68, 255, 0.6);
    transform: translateY(-2px) scale(1.05);
  }

  .team-btn.blue.selected {
    border-color: #ffffff;
    box-shadow: 0 0 25px rgba(68, 68, 255, 0.8);
    transform: translateY(-2px) scale(1.05);
  }

  .player-count {
    font-size: 13px;
    color: #cccccc;
    font-weight: bold;
    opacity: 0.9;
    background: rgba(0, 0, 0, 0.5);
    padding: 4px 8px;
    border-radius: 4px;
  }

  .score-time-container {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: stretch;
    height: 48px;
    border-radius: 12px;
    z-index: 100;
  }

  .team-banner {
    display: flex;
    align-items: center;
    padding: 0 20px;
    color: #ffffff;
    font-weight: bold;
    font-size: 18px;
    min-width: 120px;
    justify-content: center;
    gap: 12px;
  }

  .team-banner.red {
    background: linear-gradient(135deg, #ff4444, #cc3333);
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
  }

  .team-banner.blue {
    background: linear-gradient(135deg, #4444ff, #3333cc);
    border-top-right-radius: 12px;
    border-bottom-right-radius: 12px;
  }

  .team-name {
    font-size: 16px;
  }

  .team-score {
    font-size: 24px;
    font-weight: bold;
  }

  .time-display {
    background: rgba(40, 40, 40, 0.92);
    color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 24px;
    font-size: 16px;
    font-weight: bold;
    min-width: 140px;
  }

  .goals-display {
    position: fixed;
    top: 10px;
    right: 20px;
    background: rgba(40, 40, 40, 0.92);
    padding: 10px 20px;
    border-radius: 8px;
    color: #ffffff;
    font-family: "Trebuchet MS", "Arial", sans-serif;
    font-size: 18px;
    font-weight: bold;
    z-index: 100;
  }

  .game-text {
    position: fixed;
    display: none;
    font-weight: bolder;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(1);
    font-size: 8rem;
    text-transform: uppercase;
    letter-spacing: 4px;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
    animation: 
      bounce 0.5s ease-in-out infinite alternate,
      scale 0.5s ease-in-out;
    z-index: 1000;
    text-align: center;
    width: 100%;
  }

  .game-text.red {
    color: #ff4444;
  }

  .game-text.blue {
    color: #4444ff;
  }

  @keyframes bounce {
    from { transform: translate(-50%, -60%); }
    to { transform: translate(-50%, -40%); }
  }

  @keyframes scale {
    0% { transform: translate(-50%, -50%) scale(0); }
    50% { transform: translate(-50%, -50%) scale(1.2); }
    100% { transform: translate(-50%, -50%) scale(1); }
  }

  .countdown-text {
    position: fixed;
    display: none;
    font-weight: bolder;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 6rem;
    text-transform: uppercase;
    letter-spacing: 4px;
    color: #ffffff;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
    z-index: 1000;
    text-align: center;
    width: 100%;
    animation: scale-in 0.5s ease-out;
  }

  .cooldown-message {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(40, 40, 40, 0.92);
    color: #ffffff;
    padding: 8px 16px;
    border-radius: 4px;
    font-family: "Trebuchet MS", "Arial", sans-serif;
    font-size: 16px;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
    z-index: 1000;
  }

  .cooldown-message.visible {
    opacity: 1;
  }

  .ability-holder {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 64px;
    height: 64px;
    background: rgba(40, 40, 40, 0.92);
    border: 3px solid #ffffff;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .ability-holder img {
    width: 48px;
    height: 48px;
    object-fit: contain;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }

  .ability-holder img.visible {
    opacity: 1;
  }

  .ability-key {
    position: absolute;
    top: -10px;
    left: -10px;
    background: #ffffff;
    color: #000000;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: bold;
    font-family: "Trebuchet MS", "Arial", sans-serif;
  }

  /* ===== ENHANCED GOAL CELEBRATION ===== */
  .game-text {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 72px;
    font-weight: bold;
    color: #FFD700;
    text-shadow: 0 0 20px rgba(0, 0, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.5);
    text-transform: uppercase;
    letter-spacing: 4px;
    z-index: 2000;
    display: none;
    animation: goalCelebration 3s ease-in-out;
  }

  .game-text.enhanced {
    animation: enhancedGoalCelebration 3s ease-in-out;
  }

  .goal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1999;
    display: none;
    pointer-events: none;
    opacity: 0;
  }

  .goal-overlay.red {
    background: radial-gradient(circle, rgba(255, 68, 68, 0.3) 0%, transparent 70%);
    animation: goalOverlayPulse 2s ease-in-out;
  }

  .goal-overlay.blue {
    background: radial-gradient(circle, rgba(68, 68, 255, 0.3) 0%, transparent 70%);
    animation: goalOverlayPulse 2s ease-in-out;
  }

  /* ===== ANIMATIONS ===== */
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.05); }
  }

  @keyframes celebration {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }

  @keyframes goalCelebration {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
  }

  @keyframes enhancedGoalCelebration {
    0% { transform: translate(-50%, -50%) scale(0.3) rotate(-10deg); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
    40% { transform: translate(-50%, -50%) scale(0.9) rotate(-2deg); opacity: 1; }
    60% { transform: translate(-50%, -50%) scale(1.1) rotate(1deg); opacity: 1; }
    80% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0.7) rotate(0deg); opacity: 0; }
  }

  @keyframes goalOverlayPulse {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
  }

  @keyframes countdownPulse {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }

  @keyframes scale-in {
    0% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }

  /* ===== ENHANCED EXISTING ELEMENTS ===== */
  .countdown-text {
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 120px;
    font-weight: bold;
    color: #FFD700;
    text-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
    z-index: 1500;
    display: none;
    animation: countdownPulse 1s ease-in-out;
  }

  .cooldown-message {
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 165, 0, 0.9);
    color: #ffffff;
    padding: 15px 25px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1200;
    backdrop-filter: blur(10px);
  }

  .cooldown-message.visible {
    opacity: 1;
  }

  .ability-holder {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(0, 0, 0, 0.8);
    padding: 10px 15px;
    border-radius: 10px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
  }

  .ability-key {
    background: rgba(255, 255, 255, 0.2);
    color: #ffffff;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
  }

  #ability-icon {
    width: 40px;
    height: 40px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #ability-icon.visible {
    opacity: 1;
  }

  .goals-display {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: #ffffff;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    border: 2px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
    max-width: 200px;
    width: auto;
    height: auto;
    z-index: 100;
    pointer-events: none;
  }

  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .score-time-container {
      padding: 10px 15px;
      gap: 15px;
    }
    
    .team-score {
      font-size: 24px;
    }
    
    .stats-panel {
      right: 10px;
      min-width: 200px;
      padding: 15px;
    }
    
    .instructions-panel {
      width: 95vw;
      padding: 20px;
      max-height: 95vh;
    }
    
    .title-logo {
      width: min(200px, 50vw);
      height: min(200px, 50vw);
    }
    
    .game-mode-buttons {
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }
    
    .game-mode-btn {
      min-width: 80%;
      max-width: 300px;
      padding: 18px 20px;
    }
    
    .team-selection {
      gap: 15px;
    }
    
    .team-btn {
      min-width: 120px;
      padding: 14px 24px;
      font-size: 14px;
    }
    
    .selected-mode-info {
      margin: 15px 0;
      padding: 12px;
    }
  }

  @media (max-width: 480px) {
    .instructions-panel {
      padding: 15px;
    }
    
    .game-mode-title {
      font-size: 20px;
    }
    
    .team-selection {
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }
  }

  /* Enhanced Game Over Styles */
  .game-over-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .game-over-message {
    font-size: 32px;
    font-weight: bold;
    color: #FFD700;
    text-align: center;
    margin-bottom: 16px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .team-stats-container {
    margin-bottom: 30px;
  }

  .team-stats-header {
    font-size: 24px;
    font-weight: bold;
    color: #FFD700;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  .team-stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    max-width: 600px;
    margin: 0 auto;
  }

  .team-stat-column {
    background: rgba(0, 0, 0, 0.7);
    border-radius: 10px;
    padding: 20px;
    border: 2px solid;
  }

  .team-stat-column.red-team {
    border-color: #ff4444;
  }

  .team-stat-column.blue-team {
    border-color: #4444ff;
  }

  .team-stat-column .team-name {
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 15px;
    color: white;
  }

  .team-stat-column .stat-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    color: white;
  }

  .team-stat-column .stat-label {
    font-weight: bold;
  }

  .team-stat-column .stat-value {
    color: #FFD700;
    font-weight: bold;
  }

  .player-stats-container {
    margin-bottom: 20px;
  }

  .player-stats-header {
    font-size: 24px;
    font-weight: bold;
    color: #FFD700;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  .player-stats-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
    gap: 10px;
  }

  .tab-button {
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: 2px solid #666;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .tab-button.active {
    background: #FFD700;
    color: black;
    border-color: #FFD700;
  }

  .tab-button:hover {
    background: rgba(255, 215, 0, 0.2);
  }

  .player-stats-content {
    max-width: 800px;
    margin: 0 auto;
  }

  .player-stat-card {
    background: rgba(0, 0, 0, 0.7);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    border-left: 4px solid;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 15px;
    align-items: center;
  }

  .player-stat-card.red-player {
    border-left-color: #ff4444;
  }

  .player-stat-card.blue-player {
    border-left-color: #4444ff;
  }

  .player-name {
    font-weight: bold;
    color: white;
    font-size: 16px;
  }

  .player-role {
    color: #ccc;
    font-size: 12px;
    text-transform: capitalize;
  }

  .player-stat-group {
    text-align: center;
  }

  .player-stat-group .stat-number {
    font-size: 18px;
    font-weight: bold;
    color: #FFD700;
    display: block;
  }

  .player-stat-group .stat-name {
    font-size: 11px;
    color: #ccc;
    text-transform: uppercase;
  }

  /* ===== GAME MODE SELECTION STYLES ===== */
  .game-mode-selection {
    margin: 20px 0;
    padding: 0 10px;
  }

  .game-mode-title {
    color: #FFD700;
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .game-mode-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .game-mode-btn {
    position: relative;
    padding: 20px 25px;
    border: 3px solid transparent;
    border-radius: 15px;
    background: rgba(0, 0, 0, 0.4);
    color: #ffffff;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer !important;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    backdrop-filter: blur(10px);
    overflow: hidden;
    min-width: 200px;
    flex: 1;
    max-width: 300px;
    pointer-events: auto;
    outline: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  .game-mode-btn.fifa {
    border-color: #00AA00;
    background: linear-gradient(135deg, rgba(0, 170, 0, 0.2), rgba(0, 170, 0, 0.1));
  }

  .game-mode-btn.fifa:hover {
    border-color: #00FF00;
    background: linear-gradient(135deg, rgba(0, 170, 0, 0.4), rgba(0, 170, 0, 0.2));
    box-shadow: 0 10px 30px rgba(0, 170, 0, 0.3);
    transform: translateY(-3px);
  }

  .game-mode-btn.arcade {
    border-color: #FF6600;
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.2), rgba(255, 102, 0, 0.1));
  }

  .game-mode-btn.arcade:hover {
    border-color: #FF8800;
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.4), rgba(255, 102, 0, 0.2));
    box-shadow: 0 10px 30px rgba(255, 102, 0, 0.3);
    transform: translateY(-3px);
  }

  .game-mode-btn.selected {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
    border-color: #FFD700;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
  }

  .game-mode-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .game-mode-btn:hover::before {
    left: 100%;
  }

  .mode-description {
    font-size: 12px;
    margin-top: 8px;
    opacity: 0.8;
    font-weight: normal;
    text-transform: none;
    letter-spacing: 0;
  }

  .mode-features {
    font-size: 10px;
    margin-top: 5px;
    opacity: 0.6;
    font-weight: normal;
    text-transform: none;
    letter-spacing: 0;
  }

  .selected-mode-info {
    background: rgba(0, 0, 0, 0.7);
    border-radius: 10px;
    padding: 15px;
    margin: 20px auto;
    max-width: 100%;
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
  }

  .selected-mode-info h3 {
    color: #FFD700;
    font-size: 16px;
    margin-bottom: 10px;
    text-align: center;
  }

  .selected-mode-info p {
    color: #ffffff;
    font-size: 13px;
    line-height: 1.4;
    margin-bottom: 8px;
  }

  .selected-mode-info .features-list {
    color: #cccccc;
    font-size: 12px;
    line-height: 1.3;
  }

  /* Enhanced Team Selection */
  .team-selection {
    margin: 20px 0;
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    border: 2px solid rgba(255, 255, 255, 0.1);
  }

  .team-selection-title {
    color: #FFD700;
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .team-buttons-container {
    display: flex;
    gap: 24px;
    justify-content: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .team-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    min-width: 140px;
  }

  .team-btn {
    padding: 16px 32px;
    border: 3px solid transparent;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-width: 140px;
    position: relative;
    overflow: hidden;
  }

  .team-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s ease;
  }

  .team-btn:hover::before {
    left: 100%;
  }

  .team-btn.red {
    background: linear-gradient(135deg, #ff4444, #cc3333);
    color: #ffffff;
    border-color: #ff6666;
  }

  .team-btn.red:hover {
    background: linear-gradient(135deg, #ff6666, #ff4444);
    border-color: #ffffff;
    box-shadow: 0 0 20px rgba(255, 68, 68, 0.6);
    transform: translateY(-2px) scale(1.05);
  }

  .team-btn.red.selected {
    border-color: #ffffff;
    box-shadow: 0 0 25px rgba(255, 68, 68, 0.8);
    transform: translateY(-2px) scale(1.05);
  }

  .team-btn.blue {
    background: linear-gradient(135deg, #4444ff, #3333cc);
    color: #ffffff;
    border-color: #6666ff;
  }

  .team-btn.blue:hover {
    background: linear-gradient(135deg, #6666ff, #4444ff);
    border-color: #ffffff;
    box-shadow: 0 0 20px rgba(68, 68, 255, 0.6);
    transform: translateY(-2px) scale(1.05);
  }

  .team-btn.blue.selected {
    border-color: #ffffff;
    box-shadow: 0 0 25px rgba(68, 68, 255, 0.8);
    transform: translateY(-2px) scale(1.05);
  }

  .player-count {
    font-size: 13px;
    color: #cccccc;
    font-weight: bold;
    opacity: 0.9;
    background: rgba(0, 0, 0, 0.5);
    padding: 4px 8px;
    border-radius: 4px;
  }

  /* Game Options Styling */
  .game-options {
    text-align: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .option-label {
    display: inline-flex;
    align-items: center;
    cursor: pointer !important;
    color: #ffffff;
    font-size: 14px;
    user-select: none;
    position: relative;
    padding-left: 30px;
    pointer-events: auto;
  }

  .option-label input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }

  .checkmark {
    position: absolute;
    left: 0;
    height: 20px;
    width: 20px;
    background-color: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    transition: all 0.3s ease;
  }

  .option-label:hover .checkmark {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
  }

  .option-label input:checked ~ .checkmark {
    background-color: #4CAF50;
    border-color: #4CAF50;
  }

  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
  }

  .option-label input:checked ~ .checkmark:after {
    display: block;
  }

  .option-label .checkmark:after {
    left: 6px;
    top: 2px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
  }

  .option-text {
    margin-left: 8px;
    opacity: 0.9;
  }

  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .instructions-panel {
      width: 95vw;
      padding: 20px;
      max-height: 95vh;
    }
    
    .title-logo {
      width: min(200px, 50vw);
      height: min(200px, 50vw);
    }
    
    .game-mode-buttons {
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }
    
    .game-mode-btn {
      min-width: 80%;
      max-width: 300px;
      padding: 18px 20px;
    }
    
         .team-selection {
       padding: 15px;
     }

     .team-selection-title {
       font-size: 18px;
       margin-bottom: 15px;
     }

     .team-buttons-container {
       gap: 15px;
     }
     
     .team-btn {
       min-width: 120px;
       padding: 14px 24px;
       font-size: 14px;
     }
    
    .selected-mode-info {
      margin: 15px 0;
      padding: 12px;
    }
  }

  @media (max-width: 480px) {
    .instructions-panel {
      padding: 15px;
    }
    
    .game-mode-title {
      font-size: 20px;
    }
    
    .team-selection {
      padding: 12px;
    }

    .team-selection-title {
      font-size: 16px;
    }

    .team-buttons-container {
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .team-btn {
      min-width: 200px;
      padding: 16px 20px;
    }
  }

  /* ===== ARCADE MODE POWER-UP SYSTEM STYLES ===== */
  .powerup-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
    z-index: 1000;
  }

  .powerup-button {
    width: 85px;
    height: 85px;
    border-radius: 50%;
    border: 3px solid #ffd700;
    background: linear-gradient(135deg, #ff6b35, #f7931e, #ff8c42);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    pointer-events: auto;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 
      0 4px 15px rgba(255, 107, 53, 0.4),
      inset 0 2px 4px rgba(255, 255, 255, 0.2),
      inset 0 -2px 4px rgba(0, 0, 0, 0.1);
  }

  .powerup-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s ease;
  }

  .powerup-button:hover {
    transform: scale(1.15) rotate(5deg);
    box-shadow: 
      0 8px 30px rgba(255, 107, 53, 0.6),
      0 0 20px rgba(255, 215, 0, 0.4),
      inset 0 2px 6px rgba(255, 255, 255, 0.3);
    border-color: #ffed4e;
    border-width: 4px;
  }

  .powerup-button:hover::before {
    left: 100%;
  }

  .powerup-button:active {
    transform: scale(1.05) rotate(2deg);
    transition: all 0.1s ease;
  }

  .powerup-button.on-cooldown {
    background: linear-gradient(135deg, #666, #888, #777);
    border-color: #aaa;
    cursor: not-allowed;
    transform: scale(0.85);
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.3),
      inset 0 2px 4px rgba(0, 0, 0, 0.2);
    filter: grayscale(0.7);
  }

  .powerup-button.on-cooldown:hover {
    transform: scale(0.85);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .powerup-button.activating {
    animation: powerup-activation 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  @keyframes powerup-activation {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
    }
    30% { 
      transform: scale(1.4) rotate(15deg);
      box-shadow: 0 12px 40px rgba(255, 215, 0, 0.8);
      border-color: #ffed4e;
      border-width: 5px;
    }
    60% {
      transform: scale(1.2) rotate(-5deg);
      box-shadow: 0 10px 35px rgba(255, 107, 53, 0.7);
    }
    100% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
    }
  }

  .powerup-icon {
    font-size: 36px;
    color: white;
    text-shadow: 
      2px 2px 4px rgba(0, 0, 0, 0.8),
      0 0 10px rgba(255, 255, 255, 0.3);
    z-index: 2;
    transition: all 0.3s ease;
  }

  .powerup-button:hover .powerup-icon {
    font-size: 40px;
    text-shadow: 
      3px 3px 6px rgba(0, 0, 0, 0.8),
      0 0 15px rgba(255, 255, 255, 0.5);
  }

  .powerup-cooldown-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: conic-gradient(from 0deg, transparent 0%, rgba(0, 0, 0, 0.8) 0%);
    border-radius: 50%;
    transition: background 0.1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  .powerup-key-hint {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(20, 20, 20, 0.9));
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
    pointer-events: none;
    border: 1px solid rgba(255, 215, 0, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: all 0.3s ease;
  }

  .powerup-button:hover .powerup-key-hint {
    opacity: 1;
    top: -35px;
  }

  .powerup-effect-display {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 
      3px 3px 6px rgba(0, 0, 0, 0.8),
      0 0 20px rgba(255, 215, 0, 0.6);
    pointer-events: none;
    z-index: 2000;
    opacity: 0;
    animation: powerup-effect-flash 2.5s ease-out;
  }

  @keyframes powerup-effect-flash {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.3) rotate(-10deg);
    }
    15% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.3) rotate(5deg);
    }
    30% {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.1) rotate(-2deg);
    }
    70% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1) rotate(0deg);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
    }
  }

  .arcade-mode-indicator {
    position: fixed;
    top: 20px;
    left: 20px;
    background: linear-gradient(135deg, #ff6b35, #f7931e, #ff8c42);
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    font-weight: bold;
    font-size: 16px;
    border: 3px solid #ffd700;
    box-shadow: 
      0 4px 15px rgba(255, 107, 53, 0.4),
      inset 0 2px 4px rgba(255, 255, 255, 0.2);
    z-index: 1000;
    display: none;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .arcade-mode-indicator.visible {
    display: block;
    animation: arcade-mode-pulse 3s infinite;
  }

  @keyframes arcade-mode-pulse {
    0%, 100% { 
      box-shadow: 
        0 4px 15px rgba(255, 107, 53, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.2);
      transform: scale(1);
    }
    50% { 
      box-shadow: 
        0 8px 30px rgba(255, 215, 0, 0.6),
        0 0 20px rgba(255, 107, 53, 0.4),
        inset 0 2px 6px rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
  }

  /* ===== ENHANCED POWER-UP PANEL STYLES ===== */
  .powerup-panel {
    position: fixed;
    top: 100px;
    left: 20px;
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.95), rgba(255, 140, 0, 0.95), rgba(255, 165, 0, 0.95));
    border-radius: 20px;
    padding: 25px;
    border: 3px solid rgba(255, 215, 0, 0.8);
    backdrop-filter: blur(15px);
    box-shadow: 
      0 10px 40px rgba(255, 102, 0, 0.5),
      inset 0 2px 4px rgba(255, 255, 255, 0.2),
      inset 0 -2px 4px rgba(0, 0, 0, 0.1);
    min-width: 280px;
    max-width: 320px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 998;
  }

  .powerup-panel.hidden {
    transform: translateX(-110%);
    opacity: 0;
  }

  .powerup-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
    border-radius: 17px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .powerup-panel:hover::before {
    opacity: 1;
  }

  .powerup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.4);
  }

  .powerup-title {
    font-size: 18px;
    font-weight: bold;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 
      2px 2px 4px rgba(0, 0, 0, 0.8),
      0 0 10px rgba(255, 255, 255, 0.3);
  }

  .powerup-active {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 193, 7, 0.3));
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 12px;
    border: 2px solid rgba(255, 215, 0, 0.6);
    box-shadow: 
      0 4px 15px rgba(255, 215, 0, 0.2),
      inset 0 2px 4px rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
  }

  .powerup-active:hover {
    transform: translateY(-2px);
    box-shadow: 
      0 6px 20px rgba(255, 215, 0, 0.3),
      inset 0 2px 6px rgba(255, 255, 255, 0.3);
  }

  .powerup-name {
    font-size: 16px;
    font-weight: bold;
    color: #FFD700;
    margin-bottom: 6px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  .powerup-description {
    font-size: 13px;
    color: #ffffff;
    opacity: 0.95;
    line-height: 1.4;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
  }

  .powerup-cooldown {
    font-size: 11px;
    color: #ffcccc;
    margin-top: 6px;
    font-style: italic;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
  }

  .powerup-instructions {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(20, 20, 20, 0.4));
    border-radius: 12px;
    padding: 15px;
    margin-top: 15px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .powerup-key {
    display: inline-block;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2));
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 12px;
    font-weight: bold;
    color: #ffffff;
    margin-right: 6px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    box-shadow: 
      0 2px 4px rgba(0, 0, 0, 0.3),
      inset 0 1px 2px rgba(255, 255, 255, 0.3);
  }

  /* ===== RESPONSIVE DESIGN ENHANCEMENTS ===== */
  @media (max-width: 1024px) {
    .powerup-container {
      bottom: 15px;
      right: 15px;
      gap: 10px;
    }
    
    .powerup-button {
      width: 75px;
      height: 75px;
    }
    
    .powerup-icon {
      font-size: 30px;
    }
    
    .powerup-panel {
      min-width: 250px;
      max-width: 280px;
      padding: 20px;
    }
  }

  @media (max-width: 768px) {
    .powerup-container {
      bottom: 10px;
      right: 10px;
      gap: 8px;
    }
    
    .powerup-button {
      width: 65px;
      height: 65px;
    }
    
    .powerup-icon {
      font-size: 26px;
    }
    
    .powerup-button:hover .powerup-icon {
      font-size: 28px;
    }
    
    .powerup-key-hint {
      font-size: 10px;
      padding: 4px 6px;
    }
    
    .powerup-panel {
      min-width: 220px;
      max-width: 250px;
      padding: 18px;
      top: 80px;
      left: 10px;
    }
    
    .powerup-title {
      font-size: 16px;
      letter-spacing: 1px;
    }
    
    .arcade-mode-indicator {
      padding: 10px 18px;
      font-size: 14px;
      top: 15px;
      left: 15px;
    }
  }

  @media (max-width: 480px) {
    .powerup-container {
      flex-direction: row;
      bottom: 10px;
      right: 50%;
      transform: translateX(50%);
      gap: 6px;
    }
    
    .powerup-button {
      width: 55px;
      height: 55px;
    }
    
    .powerup-icon {
      font-size: 22px;
    }
    
    .powerup-key-hint {
      top: -25px;
      font-size: 9px;
    }
    
    .powerup-panel {
      position: fixed;
      top: auto;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      min-width: 90vw;
      max-width: 90vw;
      padding: 15px;
    }
    
    .powerup-panel.hidden {
      transform: translateX(-50%) translateY(100%);
    }
    
    .arcade-mode-indicator {
      padding: 8px 15px;
      font-size: 12px;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
    }
  }

  /* ===== ENHANCED VISUAL EFFECTS ===== */
  .powerup-ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 215, 0, 0.4);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
  }

  @keyframes ripple {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }

  .powerup-glow {
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border-radius: 50%;
    background: linear-gradient(45deg, #ffd700, #ff8c42, #ffd700);
    opacity: 0;
    z-index: -1;
    animation: glow 2s ease-in-out infinite alternate;
  }

  @keyframes glow {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 0.3;
      transform: scale(1.05);
    }
  }

  .powerup-button.ready .powerup-glow {
    animation-duration: 1.5s;
  }

  /* ===== FEEDBACK ANIMATIONS ===== */
  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideOutRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }

  /* ===== ENHANCED GAME MODE SELECTION POLISH ===== */
  .game-mode-btn.fifa {
    background: linear-gradient(135deg, #1e3c72, #2a5298, #3b6eb8);
    border: 3px solid #4a90e2;
    box-shadow: 
      0 6px 20px rgba(30, 60, 114, 0.4),
      inset 0 2px 4px rgba(255, 255, 255, 0.2);
  }

  .game-mode-btn.fifa:hover {
    background: linear-gradient(135deg, #2a5298, #3b6eb8, #4a90e2);
    box-shadow: 
      0 8px 30px rgba(30, 60, 114, 0.6),
      0 0 20px rgba(74, 144, 226, 0.4),
      inset 0 2px 6px rgba(255, 255, 255, 0.3);
    transform: translateY(-3px);
  }

  .game-mode-btn.arcade {
    background: linear-gradient(135deg, #ff6b35, #f7931e, #ff8c42);
    border: 3px solid #ffd700;
    box-shadow: 
      0 6px 20px rgba(255, 107, 53, 0.4),
      inset 0 2px 4px rgba(255, 255, 255, 0.2);
  }

  .game-mode-btn.arcade:hover {
    background: linear-gradient(135deg, #f7931e, #ff8c42, #ffb366);
    box-shadow: 
      0 8px 30px rgba(255, 107, 53, 0.6),
      0 0 20px rgba(255, 215, 0, 0.4),
      inset 0 2px 6px rgba(255, 255, 255, 0.3);
    transform: translateY(-3px);
  }

  .game-mode-btn.selected {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 
      0 10px 35px rgba(255, 215, 0, 0.5),
      0 0 25px rgba(255, 255, 255, 0.3),
      inset 0 3px 8px rgba(255, 255, 255, 0.4);
  }
</style>

<!-- SIMPLE BULLETPROOF SCOREBOARD -->
<div id="simple-scoreboard" style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 99999; background: black; padding: 20px; border: 3px solid white; font-family: Arial; font-size: 24px; color: white; text-align: center; min-width: 300px; display: none;">
  <div style="margin-bottom: 10px; font-size: 18px; color: yellow;">LIVE SCORE</div>
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div style="color: #ff4444; font-weight: bold;">RED: <span id="simple-red-score" style="font-size: 32px; color: white;">0</span></div>
    <div style="color: white; margin: 0 20px;">-</div>
    <div style="color: #4444ff; font-weight: bold;">BLUE: <span id="simple-blue-score" style="font-size: 32px; color: white;">0</span></div>
  </div>
  <div style="margin-top: 10px; font-size: 14px; color: #cccccc;" id="simple-timer">Waiting for game...</div>
</div>

<!-- Enhanced Main UI Structure (Hidden for now) -->
<div class="score-time-container" style="display: none;">
  <div class="team-banner red" id="red-banner">
    <div class="team-name">Red</div>
    <div class="team-score" id="red-score">0</div>
  </div>
  <div class="time-display">
    <div class="phase-indicator" id="phase-indicator">LOBBY</div>
    <span class="time-label" id="time-left">Waiting...</span>
  </div>
  <div class="team-banner blue" id="blue-banner">
    <div class="team-name">Blue</div>
    <div class="team-score" id="blue-score">0</div>
  </div>
</div>

<!-- Control Buttons -->
<div class="control-buttons">
  <button class="control-btn" id="audio-toggle" onclick="toggleAudio()" title="Toggle Audio"></button>
  <button class="control-btn" id="stats-toggle" onclick="toggleStatsPanel()" title="Toggle Statistics"></button>
  <button class="control-btn" id="powerup-toggle" onclick="togglePowerUpPanel()" title="Toggle Power-Ups (Arcade Mode)" style="display: none;"></button>
</div>

<!-- Statistics Panel -->
<div class="stats-panel hidden" id="stats-panel">
  <div class="stats-header">
    <div class="stats-title">Match Statistics</div>
  </div>
  
  <div class="stat-row">
    <div class="stat-label">Shots</div>
    <div class="stat-values">
      <div class="stat-value red" id="red-shots">0</div>
      <div class="stat-value blue" id="blue-shots">0</div>
    </div>
  </div>
  
  <div class="stat-row">
    <div class="stat-label">Passes</div>
    <div class="stat-values">
      <div class="stat-value red" id="red-passes">0</div>
      <div class="stat-value blue" id="blue-passes">0</div>
    </div>
  </div>
  
  <div class="possession-container">
    <div class="stat-label" style="margin-bottom: 8px;">Possession</div>
    <div class="possession-bar">
      <div class="possession-bar-fill" id="possession-bar-fill"></div>
    </div>
    <div class="possession-labels">
      <span id="red-possession">50%</span>
      <span id="blue-possession">50%</span>
    </div>
  </div>
</div>

<!-- Power-Up Panel (Arcade Mode Only) -->
<div class="powerup-panel hidden" id="powerup-panel">
  <div class="powerup-header">
    <div class="powerup-title"> Arcade Power-Ups</div>
  </div>
  
  <div class="powerup-active" id="active-powerup" style="display: none;">
    <div class="powerup-name" id="powerup-name">No Power-Up</div>
    <div class="powerup-description" id="powerup-description">Collect power-ups around the field!</div>
    <div class="powerup-cooldown" id="powerup-cooldown"></div>
  </div>
  
  <div class="powerup-instructions">
    <div style="color: #ffffff; font-size: 13px; margin-bottom: 8px;">
      <strong>Available Power-Ups:</strong>
    </div>
    <div style="font-size: 11px; color: #ffcccc; line-height: 1.4;">
       <strong>Freeze Blast</strong> - Freezes nearby opponents<br>
       <strong>Speed Boost</strong> - Doubles movement speed<br>
       <strong>Shuriken Throw</strong> - Stuns opponents<br>
       <strong>Fireball</strong> - Explosive projectile<br>
       <strong>Mega Kick</strong> - 3x ball power<br>
       <strong>Shield</strong> - Blocks one attack
    </div>
    <div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2);">
      Press <span class="powerup-key">F</span> to activate power-up
    </div>
  </div>
</div>

<div class="goals-display" id="goals-display" style="display: none;">Goals: 0</div>

<div class="game-text">GOAL!!!</div>
<div class="goal-overlay" id="goal-overlay"></div>
<div class="countdown-text" id="countdown-display"></div>
<div class="cooldown-message" id="cooldown-message"></div>

  <div class="ability-holder">
    <div class="ability-key">1</div>
    <img id="ability-icon" src="" alt="Ability">
  </div>

  <!-- ===== ARCADE MODE POWER-UP SYSTEM ===== -->
  <div id="arcade-mode-indicator" class="arcade-mode-indicator">
     ARCADE MODE - Enhanced Soccer!
  </div>

  <div id="powerup-container" class="powerup-container" style="display: none;">
    <div class="powerup-button" id="freeze-blast-btn" onclick="activatePowerUp('freeze_blast')" title="Freeze Blast - Freezes nearby opponents">
      <div class="powerup-key-hint">1</div>
      <div class="powerup-icon"></div>
      <div class="powerup-cooldown-overlay" id="freeze-blast-cooldown"></div>
    </div>
    
    <div class="powerup-button" id="shuriken-btn" onclick="activatePowerUp('shuriken_throw')" title="Shuriken Throw - Stuns opponents">
      <div class="powerup-key-hint">2</div>
      <div class="powerup-icon"></div>
      <div class="powerup-cooldown-overlay" id="shuriken-cooldown"></div>
    </div>
    
    <div class="powerup-button" id="fireball-btn" onclick="activatePowerUp('fireball')" title="Fireball - Explosive projectile">
      <div class="powerup-key-hint">3</div>
      <div class="powerup-icon"></div>
      <div class="powerup-cooldown-overlay" id="fireball-cooldown"></div>
    </div>
    
    <div class="powerup-button" id="mega-kick-btn" onclick="activatePowerUp('mega_kick')" title="Mega Kick - 3x ball power">
      <div class="powerup-key-hint">4</div>
      <div class="powerup-icon"></div>
      <div class="powerup-cooldown-overlay" id="mega-kick-cooldown"></div>
    </div>

    <div class="powerup-button" id="random-powerup-btn" onclick="activateRandomPowerUp()" title="Random Power-up - Surprise ability">
      <div class="powerup-key-hint">F</div>
      <div class="powerup-icon"></div>
      <div class="powerup-cooldown-overlay" id="random-powerup-cooldown"></div>
    </div>
  </div>

  <div id="powerup-effect-display" class="powerup-effect-display" style="display: none;"></div>

<div class="instructions-panel" id="instructionsPanel">
  <div class="title-container">
    <img src="{{CDN_ASSETS_URL}}/ui/logos/hysports-soccer-logo.png" alt="HySports Soccer Logo" class="title-logo">
  </div>
  
  <div class="how-to-play-container">
    <button class="how-to-play-btn">
      How to Play
      <div class="how-to-play-tooltip">
        <p> Use WASD or Arrow keys to move</p>
        <p> Left Click to pass</p>
        <p> Hold Right Mouse Button to charge a shot / Release to shoot</p>
        <p> Space bar to tackle or dodge</p>
        <p> Press F to activate power-ups (Arcade Mode only)</p>
        <p> Highest score when time expires wins!</p>
        <p> Select your game mode and team to get started!</p>
      </div>
    </button>
  </div>

  <!-- Game Mode Selection -->
  <div class="game-mode-selection" id="gameModeSelection">
    <div class="game-mode-title">Choose Game Mode</div>
    <div class="game-mode-buttons">
      <button class="game-mode-btn fifa" id="fifaModeBtn">
         FIFA Mode
        <div class="mode-description">Realistic Soccer Simulation</div>
        <div class="mode-features"> Pure soccer gameplay  5-minute matches  No power-ups</div>
      </button>
      <button class="game-mode-btn arcade" id="arcadeModeBtn">
         Arcade Mode
        <div class="mode-description">Enhanced Soccer Action</div>
        <div class="mode-features"> Power-ups & abilities  3-minute matches  Special effects</div>
      </button>
    </div>
    
    <div class="selected-mode-info" id="selectedModeInfo" style="display: none;">
      <h3 id="modeInfoTitle">Select a Game Mode</h3>
      <p id="modeInfoDescription"></p>
      <div class="features-list" id="modeInfoFeatures"></div>
    </div>
  </div>
  
  <div id="game-over-content" style="display: none;">
    <div class="game-over-header">
      <div class="game-over-message" id="game-over-title">Match Complete</div>
      <div class="final-score">
        <span class="red-score" id="final-red-score">0</span>
        -
        <span class="blue-score" id="final-blue-score">0</span>
      </div>
      <div id="winner-announcement" style="color: #FFD700; text-align: center; margin: 10px 0; font-size: 18px; font-weight: bold;"></div>
      <div id="match-info" style="color: #ccc; text-align: center; margin-bottom: 20px; font-size: 14px;"></div>
    </div>

    <!-- Team Statistics -->
    <div class="team-stats-container">
      <div class="team-stats-header">Team Statistics</div>
      <div class="team-stats-grid">
        <div class="team-stat-column red-team">
          <div class="team-name">Red Team</div>
          <div class="stat-row">
            <span class="stat-label">Goals:</span>
            <span class="stat-value" id="red-team-goals">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Shots:</span>
            <span class="stat-value" id="red-team-shots">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Passes:</span>
            <span class="stat-value" id="red-team-passes">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Tackles:</span>
            <span class="stat-value" id="red-team-tackles">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Saves:</span>
            <span class="stat-value" id="red-team-saves">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Distance:</span>
            <span class="stat-value" id="red-team-distance">0m</span>
          </div>
        </div>
        
        <div class="team-stat-column blue-team">
          <div class="team-name">Blue Team</div>
          <div class="stat-row">
            <span class="stat-label">Goals:</span>
            <span class="stat-value" id="blue-team-goals">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Shots:</span>
            <span class="stat-value" id="blue-team-shots">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Passes:</span>
            <span class="stat-value" id="blue-team-passes">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Tackles:</span>
            <span class="stat-value" id="blue-team-tackles">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Saves:</span>
            <span class="stat-value" id="blue-team-saves">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Distance:</span>
            <span class="stat-value" id="blue-team-distance">0m</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Player Statistics -->
    <div class="player-stats-container">
      <div class="player-stats-header">Player Statistics</div>
      <div class="player-stats-tabs">
        <button class="tab-button active" onclick="showPlayerTab('red')">Red Team</button>
        <button class="tab-button" onclick="showPlayerTab('blue')">Blue Team</button>
      </div>
      <div id="red-players-stats" class="player-stats-content">
        <!-- Red team player stats will be populated here -->
      </div>
      <div id="blue-players-stats" class="player-stats-content" style="display: none;">
        <!-- Blue team player stats will be populated here -->
      </div>
    </div>

    <div style="text-align: center; margin-top: 20px;">
      <button onclick="closeGameOverScreen()" style="
        background: #4CAF50;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        font-weight: bold;
      ">Return to Lobby</button>
    </div>
  </div>

  <!-- Team Selection Section -->
  <div class="team-selection" id="teamSelection" style="display: none;">
    <div class="team-selection-title">Choose Your Team</div>
    <div class="team-buttons-container">
      <div class="team-column">
        <button id="redTeamBtn" class="team-btn red">
           Join Red Team
        </button>
        <div class="player-count" id="red-team-count">Players: 0/6</div>
      </div>
      <div class="team-column">
        <button id="blueTeamBtn" class="team-btn blue">
           Join Blue Team
        </button>
        <div class="player-count" id="blue-team-count">Players: 0/6</div>
      </div>
    </div>
    
    <div class="game-options">
      <label class="option-label">
        <input type="checkbox" id="singlePlayerToggle" checked>
        <span class="checkmark"></span>
        <span class="option-text">Play with AI teammates & opponents</span>
      </label>
    </div>
  </div>
</div>

<!-- Power Bar Template -->
<template id="power-bar-template">
  <div style="
    width: 92px;
    height: 8px;
    background: rgba(0, 0, 0, 0.5);
    border: 2px solid rgba(255, 255, 255, 0.2);
    overflow: hidden;
  ">
    <div style="
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, 
        #27ae60 0%, 
        #27ae60 85%, 
        #f39c12 92%,
        #e74c3c 96%
      );
      background-size: 400% 100%;
      background-position: left;
      transition: width 0.05s linear;
    "></div>
  </div>
</template>

<!-- Phase 1: Enhanced Scripts with Modern Features -->
<script>
  // ===== PHASE 1: MODERN HUD VARIABLES =====
  let powerBarInterval = null;
  let powerBarPercentage = 0;
  let timeUntilStart = 0;
  let timeUntilStartInterval = null;
  let selectedGameMode = null; // Will be set to 'fifa' or 'arcade'
  
  // New Phase 1 variables
  let currentGameStats = {
    red: { goals: 0, shots: 0, passes: 0, possession: 50 },
    blue: { goals: 0, shots: 0, passes: 0, possession: 50 }
  };
  let playerStats = {};
  let matchPhase = "waiting";
  let audioEnabled = true;

  // ===== AUDIO SYSTEM =====
  function playUISound(soundType) {
    if (!audioEnabled) return;
    
    hytopia.sendData({
      type: "play-ui-sound",
      sound: soundType
    });
  }

  function playGoalCelebration(team) {
    if (!audioEnabled) return;
    
    hytopia.sendData({
      type: "play-goal-celebration",
      team: team
    });
  }

  // ===== GAME MODE SELECTION FUNCTIONS =====
  function selectGameMode(mode, event) {
    // Prevent any default behavior that might trigger cursor mode change
    if (event) {
      event.preventDefault();
      event.stopPropagation();
    }
    
    console.log(`Game mode selected: ${mode}`); // Debug log
    selectedGameMode = mode;
    
    // Play UI sound without sending to server immediately
    if (audioEnabled) {
      console.log("Playing UI sound locally"); // Debug log
    }
    
    // Update button states
    document.querySelectorAll('.game-mode-btn').forEach(btn => {
      btn.classList.remove('selected');
    });
    document.querySelector(`.game-mode-btn.${mode}`).classList.add('selected');
    
    // Show mode info
    const infoPanel = document.getElementById('selectedModeInfo');
    const titleEl = document.getElementById('modeInfoTitle');
    const descEl = document.getElementById('modeInfoDescription');
    const featuresEl = document.getElementById('modeInfoFeatures');
    
    if (mode === 'fifa') {
      titleEl.textContent = ' FIFA Mode Selected';
      descEl.textContent = 'Experience realistic soccer simulation with authentic gameplay mechanics and timing.';
      featuresEl.innerHTML = `
         5-minute regulation matches with possible overtime<br>
         Pure soccer gameplay - no power-ups or special abilities<br>
         Realistic physics and player movement<br>
         Focus on skill, strategy, and teamwork<br>
         Traditional soccer rules and mechanics
      `;
    } else if (mode === 'arcade') {
      titleEl.textContent = ' Arcade Mode Selected';
      descEl.textContent = 'Fast-paced soccer action with enhanced gameplay features and special effects.';
      featuresEl.innerHTML = `
         3-minute quick matches for rapid gameplay<br>
         Power-ups and special abilities for enhanced action<br>
         Enhanced physics with special moves<br>
         Particle effects and visual enhancements<br>
         Style points and arcade-style scoring
      `;
    }
    
    infoPanel.style.display = 'block';
    
    // Update power-up panel visibility based on selected mode
    updatePowerUpPanelVisibility(mode);
    
    // Show/hide arcade power-up UI based on selected mode
    if (mode === "arcade") {
      showArcadeModeUI();
    } else {
      hideArcadeModeUI();
    }
    
    // Delay server communication to avoid immediate cursor mode switch
    setTimeout(() => {
      // Send mode selection to server only when user proceeds
      if (typeof hytopia !== 'undefined' && hytopia.sendData) {
        console.log("Sending game mode to server:", mode); // Debug log
        hytopia.sendData({
          type: "select-game-mode",
          mode: mode
        });
      }
    }, 100);
    
    // Show team selection after a brief delay
    setTimeout(() => {
      document.getElementById('teamSelection').style.display = 'block';
      
      // Smooth scroll to team selection
      document.getElementById('teamSelection').scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    }, 500);
  }

  // Make function globally accessible
  window.selectGameMode = selectGameMode;

  // ===== UNIVERSAL BUTTON CLICK HANDLER TO PREVENT CURSOR ISSUES =====
  function handleButtonClick(event, callback) {
    // Comprehensive event handling to prevent cursor mode issues
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
    }
    
    // Ensure we stay in UI interaction mode
    document.body.style.cursor = 'default';
    
    // Execute the callback after a minimal delay to ensure UI state is stable
    setTimeout(() => {
      if (typeof callback === 'function') {
        callback();
      }
    }, 10);
  }

  // ===== ENHANCED SCORE ANIMATIONS =====
  function animateScoreChange(team, newScore) {
    const scoreElement = document.getElementById(`${team}-score`);
    const banner = document.getElementById(`${team}-banner`);
    
    playUISound("score-change");
    
    // Ensure score is visible first
    scoreElement.textContent = newScore;
    
    // Then animate
    scoreElement.style.transform = "scale(1.5)";
    scoreElement.style.color = "#FFD700";
    banner.style.boxShadow = `0 0 20px ${team === 'red' ? '#ff4444' : '#4444ff'}`;
    
    setTimeout(() => {
      scoreElement.style.transform = "scale(1)";
      scoreElement.style.color = "#ffffff";
      banner.style.boxShadow = "none";
    }, 300);
  }

  // ===== STATISTICS PANEL =====
  function updateStatisticsPanel() {
    const statsPanel = document.getElementById("stats-panel");
    if (!statsPanel) return;

    const redStats = currentGameStats.red;
    const blueStats = currentGameStats.blue;

    document.getElementById("red-shots").textContent = redStats.shots;
    document.getElementById("blue-shots").textContent = blueStats.shots;
    document.getElementById("red-passes").textContent = redStats.passes;
    document.getElementById("blue-passes").textContent = blueStats.passes;
    
    const possessionBar = document.getElementById("possession-bar-fill");
    possessionBar.style.width = `${redStats.possession}%`;
    
    document.getElementById("red-possession").textContent = `${redStats.possession}%`;
    document.getElementById("blue-possession").textContent = `${blueStats.possession}%`;
  }

  function toggleStatsPanel() {
    const statsPanel = document.getElementById("stats-panel");
    const toggleBtn = document.getElementById("stats-toggle");
    
    playUISound("button-click");
    
    if (statsPanel.classList.contains("hidden")) {
      statsPanel.classList.remove("hidden");
      toggleBtn.textContent = "";
    } else {
      statsPanel.classList.add("hidden");
      toggleBtn.textContent = "";
    }
  }

  function togglePowerUpPanel() {
    const powerUpPanel = document.getElementById("powerup-panel");
    const toggleBtn = document.getElementById("powerup-toggle");
    
    playUISound("button-click");
    
    if (powerUpPanel.classList.contains("hidden")) {
      powerUpPanel.classList.remove("hidden");
      toggleBtn.textContent = "";
    } else {
      powerUpPanel.classList.add("hidden");
      toggleBtn.textContent = "";
    }
  }

  // Show/hide power-up panel based on game mode
  function updatePowerUpPanelVisibility(gameMode) {
    const powerUpPanel = document.getElementById("powerup-panel");
    const powerUpToggle = document.getElementById("powerup-toggle");
    
    if (gameMode === "arcade") {
      // Show power-up panel and toggle button in arcade mode
      powerUpToggle.style.display = "flex";
      powerUpPanel.classList.remove("hidden");
    } else {
      // Hide power-up panel and toggle button in FIFA mode
      powerUpToggle.style.display = "none";
      powerUpPanel.classList.add("hidden");
    }
  }

  // Update active power-up display
  function updateActivePowerUp(powerUpData) {
    const activePowerUp = document.getElementById("active-powerup");
    const powerUpName = document.getElementById("powerup-name");
    const powerUpDescription = document.getElementById("powerup-description");
    const powerUpCooldown = document.getElementById("powerup-cooldown");
    
    if (powerUpData && powerUpData.type) {
      activePowerUp.style.display = "block";
      
      // Map power-up types to display names and descriptions
      const powerUpInfo = {
        'freeze_blast': { name: ' Freeze Blast', desc: 'Freezes nearby opponents for 4 seconds' },
        'speed_boost': { name: ' Speed Boost', desc: 'Doubles movement speed for 8 seconds' },
        'shuriken_throw': { name: ' Shuriken Throw', desc: 'Throws a stunning shuriken at opponents' },
        'fireball': { name: ' Fireball', desc: 'Launches an explosive fireball' },
        'mega_kick': { name: ' Mega Kick', desc: 'Next ball kick has 3x power and speed' },
        'shield': { name: ' Shield', desc: 'Blocks one tackle or projectile attack' },
        'speed': { name: ' Speed Enhancement', desc: 'Increased movement speed' },
        'power': { name: ' Power Enhancement', desc: 'Increased shot power' },
        'precision': { name: ' Precision Enhancement', desc: 'Improved accuracy' }
      };
      
      const info = powerUpInfo[powerUpData.type] || { name: powerUpData.type, desc: 'Unknown power-up' };
      powerUpName.textContent = info.name;
      powerUpDescription.textContent = info.desc;
      
      if (powerUpData.cooldownRemaining && powerUpData.cooldownRemaining > 0) {
        powerUpCooldown.textContent = `Cooldown: ${powerUpData.cooldownRemaining}s`;
        powerUpCooldown.style.display = "block";
      } else {
        powerUpCooldown.style.display = "none";
      }
    } else {
      activePowerUp.style.display = "none";
    }
  }

  // ===== ENHANCED TIMER SYSTEM =====
  function updateMatchTimer(data) {
    const timeLeft = document.getElementById("time-left");
    const phaseIndicator = document.getElementById("phase-indicator");
    
    matchPhase = data.status;
    
    switch(data.status) {
      case "waiting":
        timeLeft.textContent = "Waiting for players...";
        phaseIndicator.textContent = "LOBBY";
        phaseIndicator.className = "phase-indicator waiting";
        break;
      case "starting":
        timeLeft.textContent = "Starting...";
        phaseIndicator.textContent = "STARTING";
        phaseIndicator.className = "phase-indicator starting";
        break;
      case "playing":
        const minutes = Math.floor(data.timeRemaining / 60);
        const seconds = data.timeRemaining % 60;
        timeLeft.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        phaseIndicator.textContent = "MATCH";
        phaseIndicator.className = "phase-indicator playing";
        break;
      case "overtime":
        const otMinutes = Math.floor(data.timeRemaining / 60);
        const otSeconds = data.timeRemaining % 60;
        timeLeft.textContent = `${otMinutes}:${otSeconds.toString().padStart(2, '0')}`;
        phaseIndicator.textContent = "OVERTIME";
        phaseIndicator.className = "phase-indicator overtime";
        break;
      case "goal-scored":
        timeLeft.textContent = "GOAL!";
        phaseIndicator.textContent = "GOAL!";
        phaseIndicator.className = "phase-indicator goal";
        break;
      case "finished":
        timeLeft.textContent = "Game Over";
        phaseIndicator.textContent = "FINISHED";
        phaseIndicator.className = "phase-indicator finished";
        break;
    }
  }

  function toggleAudio() {
    audioEnabled = !audioEnabled;
    const audioBtn = document.getElementById("audio-toggle");
    audioBtn.textContent = audioEnabled ? "" : "";
    audioBtn.title = audioEnabled ? "Mute Audio" : "Enable Audio";
    
    playUISound("button-click");
  }

  // ===== DEBUG FUNCTIONS =====
  function testScoreDisplay() {
    console.log("Testing score display...");
    const redScore = document.getElementById("red-score");
    const blueScore = document.getElementById("blue-score");
    
    if (redScore && blueScore) {
      redScore.textContent = "5";
      blueScore.textContent = "3";
      console.log("Test scores set: Red 5, Blue 3");
      console.log("Red score element:", redScore);
      console.log("Blue score element:", blueScore);
      console.log("Red score styles:", window.getComputedStyle(redScore));
      console.log("Blue score styles:", window.getComputedStyle(blueScore));
    } else {
      console.error("Score elements not found!");
    }
  }

  // Add debug function to global scope for testing
  window.testScoreDisplay = testScoreDisplay;

  // ===== TEAM SELECTION =====
  function selectTeam(team, event) {
    // Prevent any default behavior that might trigger cursor mode change
    if (event) {
      event.preventDefault();
      event.stopPropagation();
    }
    
    console.log(`Team selected: ${team}`);
    
    // Ensure a game mode has been selected
    if (!selectedGameMode) {
      alert("Please select a game mode first!");
      return;
    }
    
    // Play UI sound locally without server communication
    if (audioEnabled) {
      console.log("Playing team selection sound locally");
    }
    
    const buttons = document.querySelectorAll(".team-btn");
    buttons.forEach((btn) => btn.classList.remove("selected"));

    const selectedBtn = team === "red" ? document.getElementById("redTeamBtn") : document.getElementById("blueTeamBtn");
    selectedBtn.classList.add("selected");

    const singlePlayerMode = document.getElementById("singlePlayerToggle").checked;

    // Hide the instructions panel
    document.getElementById("instructionsPanel").classList.add("hidden");
    
    // Send team selection to server after a brief delay to ensure UI transition completes
    setTimeout(() => {
      if (typeof hytopia !== 'undefined' && hytopia.sendData) {
        console.log("Sending team selection to server:", team);
        hytopia.sendData({
          type: "team-selected",
          team: team,
          singlePlayerMode: singlePlayerMode,
          gameMode: selectedGameMode
        });
      }
    }, 200);
  }

  // ===== INITIALIZATION =====
  // Initialize score display
  function initializeScoreDisplay() {
    // Initialize SIMPLE scoreboard (bulletproof)
    const simpleRedScore = document.getElementById("simple-red-score");
    const simpleBlueScore = document.getElementById("simple-blue-score");
    const simpleTimer = document.getElementById("simple-timer");
    
    if (simpleRedScore && simpleBlueScore) {
      simpleRedScore.textContent = "0";
      simpleBlueScore.textContent = "0";
      simpleTimer.textContent = "Waiting for game...";
      console.log("SIMPLE SCOREBOARD initialized with values:", simpleRedScore.textContent, simpleBlueScore.textContent);
    } else {
      console.error("Could not find SIMPLE score elements!"); 
    }
    
    // Also initialize original scoreboard (backup)
    const redScore = document.getElementById("red-score");
    const blueScore = document.getElementById("blue-score");
    
    if (redScore && blueScore) {
      redScore.textContent = "0";
      blueScore.textContent = "0";
      redScore.style.display = "block";
      blueScore.style.display = "block";
      console.log("Original score display initialized with values:", redScore.textContent, blueScore.textContent);
    }
    
    // Also initialize other UI elements
    const phaseIndicator = document.getElementById("phase-indicator");
    const timeLeft = document.getElementById("time-left");
    
    if (phaseIndicator) {
      phaseIndicator.textContent = "LOBBY";
      phaseIndicator.className = "phase-indicator waiting";
    }
    
    if (timeLeft) {
      timeLeft.textContent = "Waiting for players...";
    }
    
    console.log("UI initialization complete");
  }

  // Add click event listeners immediately (DOM is already loaded since script is at bottom)
  const redTeamBtn = document.getElementById("redTeamBtn");
  const blueTeamBtn = document.getElementById("blueTeamBtn");
  const fifaModeBtn = document.getElementById("fifaModeBtn");
  const arcadeModeBtn = document.getElementById("arcadeModeBtn");
  
  console.log("Red button:", redTeamBtn); // Debug log
  console.log("Blue button:", blueTeamBtn); // Debug log
  console.log("FIFA button:", fifaModeBtn); // Debug log
  console.log("Arcade button:", arcadeModeBtn); // Debug log
  
  // Team selection event listeners with universal handler
  if (redTeamBtn && blueTeamBtn) {
    redTeamBtn.addEventListener("click", (e) => {
      handleButtonClick(e, () => selectTeam("red", e));
    });
    blueTeamBtn.addEventListener("click", (e) => {
      handleButtonClick(e, () => selectTeam("blue", e));
    });
    console.log("Team selection event listeners added successfully"); // Debug log
  } else {
    console.error("Could not find team buttons!"); // Debug log
  }
  
  // Game mode selection event listeners with universal handler
  if (fifaModeBtn && arcadeModeBtn) {
    fifaModeBtn.addEventListener("click", (e) => {
      handleButtonClick(e, () => selectGameMode("fifa", e));
    });
    arcadeModeBtn.addEventListener("click", (e) => {
      handleButtonClick(e, () => selectGameMode("arcade", e));
    });
    console.log("Game mode event listeners added successfully"); // Debug log
  } else {
    console.error("Could not find game mode buttons!"); // Debug log
  }

  // Initialize the UI with error handling
  try {
    initializeScoreDisplay();
    console.log(' UI initialization completed successfully');
  } catch (error) {
    console.error(' UI initialization error:', error);
  }

  // Final safety check - ensure all buttons are responsive
  setTimeout(() => {
    const allButtons = document.querySelectorAll('button, .btn, .team-btn, .game-mode-btn, .control-btn, .how-to-play-btn, .tab-button');
    let buttonIssues = 0;
    
    allButtons.forEach((button, index) => {
      if (!button.style.cursor || button.style.cursor === 'default') {
        button.style.cursor = 'pointer';
        buttonIssues++;
      }
      if (button.style.pointerEvents === 'none') {
        button.style.pointerEvents = 'auto';
        buttonIssues++;
      }
    });
    
    if (buttonIssues > 0) {
      console.warn(` Fixed ${buttonIssues} button cursor/pointer issues`);
    }
    
    console.log(` Final button check: ${allButtons.length} buttons verified as clickable`);
  }, 1000);
  
  // ===== MESSAGE HANDLERS =====
  // Listen for messages from the server
  if (typeof hytopia !== 'undefined' && hytopia.onMessage) {
    hytopia.onMessage((data) => {
      if (data.type === "game-mode-confirmed") {
        console.log(`Game mode confirmed: ${data.mode}`);
        // Update UI to show the confirmed mode
        const selectedModeInfo = document.getElementById('selectedModeInfo');
        if (selectedModeInfo) {
          selectedModeInfo.style.borderColor = '#00FF00';
          setTimeout(() => {
            selectedModeInfo.style.borderColor = 'rgba(255, 215, 0, 0.3)';
          }, 1000);
        }
      }
    });
  }
  
  // Add debugging function to test score visibility
  function testScoreDisplay() {
    const redScore = document.getElementById("red-score");
    const blueScore = document.getElementById("blue-score");
    
    console.log("=== SCORE ELEMENT DEBUG ===");
    console.log("Red score element:", redScore);
    console.log("Blue score element:", blueScore);
    
    if (redScore) {
      console.log("Red score computed style:", window.getComputedStyle(redScore));
      console.log("Red score display:", window.getComputedStyle(redScore).display);
      console.log("Red score visibility:", window.getComputedStyle(redScore).visibility);
      console.log("Red score opacity:", window.getComputedStyle(redScore).opacity);
      console.log("Red score color:", window.getComputedStyle(redScore).color);
      console.log("Red score text content:", redScore.textContent);
      console.log("Red score innerHTML:", redScore.innerHTML);
      
      // Force visibility
      redScore.style.display = "flex !important";
      redScore.style.visibility = "visible !important";
      redScore.style.opacity = "1 !important";
      redScore.style.color = "#ffffff !important";
      redScore.style.fontSize = "28px !important";
      redScore.style.fontWeight = "bold !important";
      redScore.style.zIndex = "9999 !important";
      redScore.style.background = "rgba(255, 0, 0, 0.5) !important"; // Temporary red background for debugging
    }
    
    if (blueScore) {
      console.log("Blue score computed style:", window.getComputedStyle(blueScore));
      console.log("Blue score display:", window.getComputedStyle(blueScore).display);
      console.log("Blue score visibility:", window.getComputedStyle(blueScore).visibility);
      console.log("Blue score opacity:", window.getComputedStyle(blueScore).opacity);
      console.log("Blue score color:", window.getComputedStyle(blueScore).color);
      console.log("Blue score text content:", blueScore.textContent);
      console.log("Blue score innerHTML:", blueScore.innerHTML);
      
      // Force visibility
      blueScore.style.display = "flex !important";
      blueScore.style.visibility = "visible !important";
      blueScore.style.opacity = "1 !important";
      blueScore.style.color = "#ffffff !important";
      blueScore.style.fontSize = "28px !important";
      blueScore.style.fontWeight = "bold !important";
      blueScore.style.zIndex = "9999 !important";
      blueScore.style.background = "rgba(0, 0, 255, 0.5) !important"; // Temporary blue background for debugging
    }
    
    console.log("=== END DEBUG ===");
  }
  
  // Test score display after a short delay
  setTimeout(() => {
    testScoreDisplay();
  }, 2000);
  
  // Add global test function for manual testing
  window.forceUpdateScores = function(red = 1, blue = 1) {
    console.log(`Forcing score update: Red ${red}, Blue ${blue}`);
    
    // Update SIMPLE scoreboard
    const simpleRedScore = document.getElementById("simple-red-score");
    const simpleBlueScore = document.getElementById("simple-blue-score");
    
    if (simpleRedScore && simpleBlueScore) {
      simpleRedScore.textContent = red;
      simpleBlueScore.textContent = blue;
      simpleRedScore.style.color = "#ffff00"; // Make it yellow for visibility
      simpleBlueScore.style.color = "#ffff00"; // Make it yellow for visibility
      console.log("SIMPLE SCOREBOARD forcefully updated!");
    }
    
    // Also update original scoreboard
    const redScore = document.getElementById("red-score");
    const blueScore = document.getElementById("blue-score");
    
    if (redScore && blueScore) {
      redScore.textContent = red;
      blueScore.textContent = blue;
      redScore.style.background = "rgba(255, 0, 0, 0.8)";
      blueScore.style.background = "rgba(0, 0, 255, 0.8)";
      redScore.style.color = "#ffffff";
      blueScore.style.color = "#ffffff";
      redScore.style.fontSize = "32px";
      blueScore.style.fontSize = "32px";
      redScore.style.fontWeight = "bold";
      blueScore.style.fontWeight = "bold";
      redScore.style.display = "flex";
      blueScore.style.display = "flex";
      redScore.style.alignItems = "center";
      blueScore.style.alignItems = "center";
      redScore.style.justifyContent = "center";
      blueScore.style.justifyContent = "center";
      console.log("Original scores forcefully updated!");
    } else {
      console.error("Could not find original score elements!");
    }
  };
  
  // Request initial game state from server
  setTimeout(() => {
    console.log("Requesting initial game state...");
    hytopia.sendData({
      type: "request-game-state"
    });
  }, 1000);

  // ===== DATA HANDLER =====
  hytopia.onData((data) => {
    console.log("Received data:", data.type, data);
    
    // Debug score data specifically
    if (data.type === "game-state" && data.score) {
      console.log("Score data received:", data.score);
    }
    
    if (data.type === "game-state") {
      console.log("Processing game-state data:", data);
      
      // Show scoreboard when game starts (starting, playing, or overtime states)
      const simpleScoreboard = document.getElementById("simple-scoreboard");
      if (simpleScoreboard && data.status && (data.status === "starting" || data.status === "playing" || data.status === "overtime")) {
        simpleScoreboard.style.display = "block";
        console.log("Scoreboard shown - game status:", data.status);
      } else if (simpleScoreboard && data.status === "waiting") {
        simpleScoreboard.style.display = "none";
        console.log("Scoreboard hidden - game status:", data.status);
      }
      
      // Update SIMPLE scoreboard (bulletproof approach)
      const newRedScore = data.score ? data.score.red : 0;
      const newBlueScore = data.score ? data.score.blue : 0;
      
      // Update simple scoreboard
      const simpleRedScore = document.getElementById("simple-red-score");
      const simpleBlueScore = document.getElementById("simple-blue-score");
      const simpleTimer = document.getElementById("simple-timer");
      
      if (simpleRedScore && simpleBlueScore) {
        simpleRedScore.textContent = newRedScore;
        simpleBlueScore.textContent = newBlueScore;
        console.log("SIMPLE SCOREBOARD UPDATED:", newRedScore, newBlueScore);
      }
      
      // Update timer
      if (simpleTimer && data.timeRemaining) {
        const minutes = Math.floor(data.timeRemaining / 60);
        const seconds = data.timeRemaining % 60;
        simpleTimer.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, '0')} | Status: ${data.status || 'playing'}`;
      }
      
      // Also update original scoreboard (for backup)
      const originalRedScore = document.getElementById("red-score");
      const originalBlueScore = document.getElementById("blue-score");
      if (originalRedScore && originalBlueScore) {
        originalRedScore.textContent = newRedScore;
        originalBlueScore.textContent = newBlueScore;
      }
      
      console.log("Updated scores:", newRedScore, newBlueScore);
      
      // Update timer with enhanced display
      updateMatchTimer(data);
      
      // Update statistics if provided
      if (data.stats) {
        currentGameStats = data.stats;
        updateStatisticsPanel();
      }
    }

    if (data.type === "team-counts") {
      console.log("Processing team-counts data:", data);
      // Update team counts (sent separately from game-state)
      document.getElementById("red-team-count").textContent = `Players: ${data.red}/${data.maxPlayers}`;
      document.getElementById("blue-team-count").textContent = `Players: ${data.blue}/${data.maxPlayers}`;
    }

    if (data.type === "goal" || data.type === "goal-scored") {
      showEnhancedGoal(data.team);
      playGoalCelebration(data.team);
      
      if (data.score) {
        animateScoreChange("red", data.score.red);
        animateScoreChange("blue", data.score.blue);
      }
    }

    if (data.type === "countdown") {
      showCountdown(data.count);
    }

    if (data.type === "power-bar") {
      updatePowerBar(data.percentage);
    }

    if (data.type === "goals-scored") {
      // Goals display is now hidden - score is shown in main scoreboard
      // document.getElementById("goals-display").textContent = `Goals: ${data.goals}`;
    }

    if (data.type === "cooldown") {
      showCooldownMessage(data.message, data.duration);
    }

    if (data.type === "ability") {
      showAbility(data.iconUrl);
    }

    // New Phase 1 data handlers
    if (data.type === "player-stats") {
      playerStats = data.stats;
      updatePlayerStatsDisplay();
    }

    if (data.type === "match-stats") {
      currentGameStats = data.stats;
      updateStatisticsPanel();
    }

    if (data.type === "game-over") {
      showEnhancedGameOver(data);
    }

    if (data.type === "regulation-time-stats") {
      showRegulationTimeStats(data);
    }

    if (data.type === "game-reset") {
      handleGameReset(data);
    }

    // Handle powerup feedback from F key activation
    if (data.type === "powerup-feedback") {
      console.log("Powerup feedback received:", data);
      showPowerupFeedback(data);
    }

    // Handle specific power-up activation responses
    if (data.type === "powerup-activated") {
      console.log("Powerup activated response:", data);
      showPowerupFeedback({
        success: true,
        powerUpType: data.powerUpType,
        message: data.message || `${getPowerupName(data.powerUpType)} activated!`
      });
    }
  });

  // ===== ENHANCED GOAL CELEBRATION =====
  function showEnhancedGoal(team) {
    const goalText = document.querySelector(".game-text");
    const goalOverlay = document.getElementById("goal-overlay");
    
    goalText.className = `game-text ${team} enhanced`;
    goalText.style.display = "block";
    
    if (goalOverlay) {
      goalOverlay.className = `goal-overlay ${team}`;
      goalOverlay.style.display = "block";
      
      setTimeout(() => {
        goalOverlay.style.display = "none";
      }, 2000);
    }
    
    setTimeout(() => {
      goalText.style.display = "none";
    }, 3000);
  }

  // ===== UTILITY FUNCTIONS =====
  function showCountdown(count) {
    const countdownText = document.getElementById("countdown-display");
    countdownText.textContent = count;
    countdownText.style.display = "block";
    
    playUISound("countdown");
    
    setTimeout(() => {
      countdownText.style.display = "none";
    }, 1000);
  }



  function updatePlayerStatsDisplay() {
    // Update individual player stats if panel is visible
    const playerStatsPanel = document.getElementById("player-stats-panel");
    if (playerStatsPanel && !playerStatsPanel.classList.contains("hidden")) {
      // Implementation for detailed player stats
    }
  }

  function updatePowerBar(percentage) {
    powerBarPercentage = percentage;
    
    // Find all power bars and update them
    const powerBars = document.querySelectorAll('[data-power-bar]');
    powerBars.forEach(bar => {
      const fillElement = bar.querySelector('div > div');
      if (fillElement) {
        fillElement.style.width = `${percentage}%`;
      }
    });
  }

  function showCooldownMessage(message, duration) {
    const cooldownMsg = document.getElementById("cooldown-message");
    cooldownMsg.textContent = message;
    cooldownMsg.classList.add("visible");
    
    setTimeout(() => {
      cooldownMsg.classList.remove("visible");
    }, duration);
  }

  function showAbility(iconUrl) {
    const abilityIcon = document.getElementById("ability-icon");
    abilityIcon.src = iconUrl;
    abilityIcon.classList.add("visible");
    
    setTimeout(() => {
      abilityIcon.classList.remove("visible");
    }, 3000);
  }

  // ===== POWERUP FEEDBACK =====
  function showPowerupFeedback(data) {
    // Create or update powerup feedback notification
    let notification = document.getElementById("powerup-notification");
    
    if (!notification) {
      notification = document.createElement('div');
      notification.id = "powerup-notification";
      notification.style.cssText = `
        position: fixed;
        top: 150px;
        left: 50%;
        transform: translateX(-50%);
        padding: 15px 25px;
        border-radius: 10px;
        font-weight: bold;
        font-size: 16px;
        z-index: 9999;
        transition: all 0.3s ease;
        opacity: 0;
        pointer-events: none;
        max-width: 300px;
        text-align: center;
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
      `;
      document.body.appendChild(notification);
    }

    // Style based on success/failure
    if (data.success) {
      notification.style.background = "linear-gradient(135deg, rgba(0, 200, 0, 0.9), rgba(0, 150, 0, 0.9))";
      notification.style.color = "#ffffff";
      notification.style.borderColor = "#00ff00";
      notification.textContent = data.message || ` POWERUP ACTIVATED!`;
      
      // Play success sound
      playUISound("button-click");
    } else {
      notification.style.background = "linear-gradient(135deg, rgba(200, 100, 0, 0.9), rgba(150, 80, 0, 0.9))";
      notification.style.color = "#ffffff";
      notification.style.borderColor = "#ffaa00";
      notification.textContent = data.message || " Powerup failed";
    }

    // Show notification
    notification.style.opacity = "1";
    
    // Hide after 3 seconds
    setTimeout(() => {
      notification.style.opacity = "0";
    }, 3000);
  }

  // ===== ENHANCED GAME OVER FUNCTIONS =====
  function showEnhancedGameOver(data) {
    const panel = document.getElementById("instructionsPanel");
    const gameOverContent = document.getElementById("game-over-content");
    const howToPlayContainer = document.querySelector(".how-to-play-container");
    const teamSelection = document.querySelector(".team-selection");
    const gameModeSelection = document.getElementById("gameModeSelection");
    
    playUISound("game-over");
    
    // Hide other content
    if (howToPlayContainer) howToPlayContainer.style.display = "none";
    if (teamSelection) teamSelection.style.display = "none";
    if (gameModeSelection) gameModeSelection.style.display = "none";
    gameOverContent.style.display = "block";
    
    // Update header information
    document.getElementById("final-red-score").textContent = data.redScore;
    document.getElementById("final-blue-score").textContent = data.blueScore;
    
    // Update winner announcement
    const winnerAnnouncement = document.getElementById("winner-announcement");
    if (data.winner === 'tie') {
      winnerAnnouncement.textContent = "Match Tied!";
      winnerAnnouncement.style.color = "#FFD700";
    } else if (data.winner === 'red') {
      winnerAnnouncement.textContent = "Red Team Wins!";
      winnerAnnouncement.style.color = "#ff4444";
    } else if (data.winner === 'blue') {
      winnerAnnouncement.textContent = "Blue Team Wins!";
      winnerAnnouncement.style.color = "#4444ff";
    }
    
    // Update match info
    const matchInfo = document.getElementById("match-info");
    const duration = Math.floor(data.matchDuration / 60);
    const seconds = data.matchDuration % 60;
    const overtimeText = data.wasOvertime ? " (Including Overtime)" : "";
    matchInfo.textContent = `Match Duration: ${duration}:${seconds.toString().padStart(2, '0')}${overtimeText}`;
    
    // Update team statistics
    updateTeamStats(data.teamStats);
    
    // Update player statistics
    updatePlayerStats(data.playerStats);
    
    panel.classList.remove("hidden");
  }

  function showRegulationTimeStats(data) {
    // Show a temporary overlay with regulation time stats
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-family: "Trebuchet MS", Arial, sans-serif;
    `;
    
    overlay.innerHTML = `
      <div style="text-align: center; background: rgba(20, 20, 20, 0.95); padding: 40px; border-radius: 20px; border: 3px solid #FFD700;">
        <h2 style="color: #FFD700; margin-bottom: 20px; font-size: 32px;">${data.message}</h2>
        <div style="font-size: 24px; margin-bottom: 20px;">
          Red ${data.redScore} - ${data.blueScore} Blue
        </div>
        <div style="color: #ccc; margin-bottom: 30px;">
          ${data.redScore === data.blueScore ? 'Proceeding to Overtime...' : 'Match Complete!'}
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 600px;">
          ${data.playerStats.slice(0, 6).map(player => `
            <div style="background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 8px; border-left: 4px solid ${player.team === 'red' ? '#ff4444' : '#4444ff'};">
              <div style="font-weight: bold; margin-bottom: 5px;">${player.name}</div>
              <div style="font-size: 12px; color: #ccc; margin-bottom: 10px;">${player.role}</div>
              <div style="display: flex; justify-content: space-between;">
                <span>Goals:</span>
                <span style="color: #FFD700; font-weight: bold;">${player.goals}</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span>Tackles:</span>
                <span style="color: #FFD700; font-weight: bold;">${player.tackles}</span>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
    
    document.body.appendChild(overlay);
    
    // Remove overlay after 3 seconds
    setTimeout(() => {
      document.body.removeChild(overlay);
    }, 3000);
  }

  function updateTeamStats(teamStats) {
    // Update red team stats
    document.getElementById("red-team-goals").textContent = teamStats.red.goals;
    document.getElementById("red-team-shots").textContent = teamStats.red.shots;
    document.getElementById("red-team-passes").textContent = teamStats.red.passes;
    document.getElementById("red-team-tackles").textContent = teamStats.red.tackles;
    document.getElementById("red-team-saves").textContent = teamStats.red.saves;
    document.getElementById("red-team-distance").textContent = Math.round(teamStats.red.distanceTraveled) + "m";
    
    // Update blue team stats
    document.getElementById("blue-team-goals").textContent = teamStats.blue.goals;
    document.getElementById("blue-team-shots").textContent = teamStats.blue.shots;
    document.getElementById("blue-team-passes").textContent = teamStats.blue.passes;
    document.getElementById("blue-team-tackles").textContent = teamStats.blue.tackles;
    document.getElementById("blue-team-saves").textContent = teamStats.blue.saves;
    document.getElementById("blue-team-distance").textContent = Math.round(teamStats.blue.distanceTraveled) + "m";
  }

  function updatePlayerStats(playerStats) {
    const redPlayers = playerStats.filter(p => p.team === 'red');
    const bluePlayers = playerStats.filter(p => p.team === 'blue');
    
    // Update red team players
    const redContainer = document.getElementById("red-players-stats");
    redContainer.innerHTML = redPlayers.map(player => `
      <div class="player-stat-card red-player">
        <div>
          <div class="player-name">${player.name}</div>
          <div class="player-role">${player.role.replace(/-/g, ' ')}</div>
        </div>
        <div class="player-stat-group">
          <span class="stat-number">${player.goals}</span>
          <span class="stat-name">Goals</span>
        </div>
        <div class="player-stat-group">
          <span class="stat-number">${player.tackles}</span>
          <span class="stat-name">Tackles</span>
        </div>
        <div class="player-stat-group">
          <span class="stat-number">${player.distanceTraveled}m</span>
          <span class="stat-name">Distance</span>
        </div>
      </div>
    `).join('');
    
    // Update blue team players
    const blueContainer = document.getElementById("blue-players-stats");
    blueContainer.innerHTML = bluePlayers.map(player => `
      <div class="player-stat-card blue-player">
        <div>
          <div class="player-name">${player.name}</div>
          <div class="player-role">${player.role.replace(/-/g, ' ')}</div>
        </div>
        <div class="player-stat-group">
          <span class="stat-number">${player.goals}</span>
          <span class="stat-name">Goals</span>
        </div>
        <div class="player-stat-group">
          <span class="stat-number">${player.tackles}</span>
          <span class="stat-name">Tackles</span>
        </div>
        <div class="player-stat-group">
          <span class="stat-number">${player.distanceTraveled}m</span>
          <span class="stat-name">Distance</span>
        </div>
      </div>
    `).join('');
  }

  function showPlayerTab(team) {
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Show/hide player stats content
    document.getElementById('red-players-stats').style.display = team === 'red' ? 'block' : 'none';
    document.getElementById('blue-players-stats').style.display = team === 'blue' ? 'block' : 'none';
  }

  // Make function globally accessible
  window.showPlayerTab = showPlayerTab;

  function closeGameOverScreen() {
    const panel = document.getElementById("instructionsPanel");
    const gameOverContent = document.getElementById("game-over-content");
    const howToPlayContainer = document.querySelector(".how-to-play-container");
    const teamSelection = document.querySelector(".team-selection");
    const gameModeSelection = document.getElementById("gameModeSelection");
    const selectedModeInfo = document.getElementById("selectedModeInfo");
    
    // Reset game mode selection
    selectedGameMode = null;
    document.querySelectorAll('.game-mode-btn').forEach(btn => {
      btn.classList.remove('selected');
    });
    if (selectedModeInfo) selectedModeInfo.style.display = "none";
    
    // Hide game over content and show normal lobby
    gameOverContent.style.display = "none";
    if (howToPlayContainer) howToPlayContainer.style.display = "block";
    if (gameModeSelection) gameModeSelection.style.display = "block";
    if (teamSelection) teamSelection.style.display = "none"; // Hide until mode is selected again
    
    playUISound("button-click");
  }

  // Make function globally accessible
  window.closeGameOverScreen = closeGameOverScreen;

  // ===== ENSURE ALL ONCLICK FUNCTIONS ARE AVAILABLE =====
  // Make all functions globally accessible to prevent "function not defined" errors
  window.toggleAudio = toggleAudio;
  window.toggleStatsPanel = toggleStatsPanel;
  window.togglePowerUpPanel = togglePowerUpPanel;
  window.selectTeam = selectTeam;
  window.selectGameMode = selectGameMode;
  window.showPlayerTab = showPlayerTab;
  window.closeGameOverScreen = closeGameOverScreen;
  
  // Add any missing functions with safe defaults
  if (typeof window.startPenaltyShootout === 'undefined') {
    window.startPenaltyShootout = function() {
      console.log('Penalty shootout functionality not yet implemented');
      alert('Penalty shootout mode coming soon!');
    };
  }

  // Error handling for any missing functions
  window.addEventListener('error', function(e) {
    if (e.message && e.message.includes('is not defined')) {
      console.warn('Function not defined error caught:', e.message);
      e.preventDefault(); // Prevent the error from breaking the UI
    }
  });

  // Add universal click handlers for inline onclick buttons
  document.addEventListener('DOMContentLoaded', function() {
    // Audio toggle button
    const audioToggle = document.getElementById('audio-toggle');
    if (audioToggle) {
      audioToggle.addEventListener('click', (e) => {
        handleButtonClick(e, toggleAudio);
      });
    }

    // Stats toggle button  
    const statsToggle = document.getElementById('stats-toggle');
    if (statsToggle) {
      statsToggle.addEventListener('click', (e) => {
        handleButtonClick(e, toggleStatsPanel);
      });
    }

    // Power-up toggle button
    const powerupToggle = document.getElementById('powerup-toggle');
    if (powerupToggle) {
      powerupToggle.addEventListener('click', (e) => {
        handleButtonClick(e, togglePowerUpPanel);
      });
    }

    // Add event listeners to any other buttons that use onclick
    document.querySelectorAll('button[onclick]').forEach(button => {
      const originalOnclick = button.getAttribute('onclick');
      button.removeAttribute('onclick'); // Remove onclick to prevent conflicts
      
      button.addEventListener('click', (e) => {
        handleButtonClick(e, () => {
          // Safely execute the original onclick content
          try {
            eval(originalOnclick);
          } catch (error) {
            console.warn('Error executing onclick:', error);
          }
        });
      });
    });
  });

  function handleGameReset(data) {
    console.log("Game reset received:", data.message);
    
    // Reset UI state to lobby
    const panel = document.getElementById("instructionsPanel");
    const gameOverContent = document.getElementById("game-over-content");
    const howToPlayContainer = document.querySelector(".how-to-play-container");
    const teamSelection = document.querySelector(".team-selection");
    const gameModeSelection = document.getElementById("gameModeSelection");
    const selectedModeInfo = document.getElementById("selectedModeInfo");
    
    // Reset game mode selection
    selectedGameMode = null;
    document.querySelectorAll('.game-mode-btn').forEach(btn => {
      btn.classList.remove('selected');
    });
    if (selectedModeInfo) selectedModeInfo.style.display = "none";
    
    // Clear team selection
    document.querySelectorAll('.team-btn').forEach(btn => {
      btn.classList.remove('selected');
    });
    
    // Show lobby UI
    gameOverContent.style.display = "none";
    if (howToPlayContainer) howToPlayContainer.style.display = "block";
    if (gameModeSelection) gameModeSelection.style.display = "block";
    if (teamSelection) teamSelection.style.display = "none"; // Hide until mode is selected again
    
    // Reset scoreboard
    initializeScoreDisplay();
    
    // Show notification message
    if (data.message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 193, 7, 0.9);
        color: black;
        padding: 15px 25px;
        border-radius: 8px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      `;
      notification.textContent = data.message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          document.body.removeChild(notification);
        }
      }, 4000);
    }
    
    playUISound("button-click");
  }

  // ===== ARCADE MODE POWER-UP SYSTEM FUNCTIONS =====
  
  // Power-up cooldowns (in milliseconds)
  const POWERUP_COOLDOWNS = {
    'freeze_blast': 10000,    // 10 seconds
    'shuriken_throw': 8000,   // 8 seconds  
    'fireball': 12000,        // 12 seconds
    'mega_kick': 15000,       // 15 seconds
    'random_powerup': 3000    // 3 seconds for F key
  };

  // Track cooldown states
  const powerupCooldownStates = {
    'freeze_blast': { onCooldown: false, endTime: 0 },
    'shuriken_throw': { onCooldown: false, endTime: 0 },
    'fireball': { onCooldown: false, endTime: 0 },
    'mega_kick': { onCooldown: false, endTime: 0 },
    'random_powerup': { onCooldown: false, endTime: 0 }
  };

  // Enhanced power-up activation with visual effects
  function activatePowerUpWithEffects(powerUpType) {
    const button = document.getElementById(`${powerUpType.replace('_', '-')}-btn`);
    if (!button) return false;

    // Check if on cooldown
    if (powerupCooldownStates[powerUpType] && powerupCooldownStates[powerUpType].onCooldown) {
      showPowerUpFeedback('Power-up on cooldown!', 'error');
      return false;
    }

    // Add activation animation
    button.classList.add('activating');
    
    // Create ripple effect
    createRippleEffect(button);
    
    // Add glow effect temporarily
    const glowElement = document.createElement('div');
    glowElement.className = 'powerup-glow';
    button.appendChild(glowElement);
    
    // Remove effects after animation
    setTimeout(() => {
      button.classList.remove('activating');
      if (glowElement.parentNode) {
        glowElement.parentNode.removeChild(glowElement);
      }
    }, 800);

    // Send activation to server
    if (typeof hytopia !== 'undefined' && hytopia.sendData) {
      hytopia.sendData({
        type: "activate-powerup",
        powerUpType: powerUpType
      });
    }

    // Start cooldown
    startPowerUpCooldown(powerUpType);
    
    // Show activation feedback
    showPowerUpActivationEffect(powerUpType);
    
    return true;
  }

  // Create ripple effect on button click
  function createRippleEffect(button) {
    const ripple = document.createElement('div');
    ripple.className = 'powerup-ripple';
    
    const rect = button.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = rect.width / 2 - size / 2;
    const y = rect.height / 2 - size / 2;
    
    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = x + 'px';
    ripple.style.top = y + 'px';
    
    button.appendChild(ripple);
    
    setTimeout(() => {
      if (ripple.parentNode) {
        ripple.parentNode.removeChild(ripple);
      }
    }, 600);
  }

  // Enhanced power-up activation effect
  function showPowerUpActivationEffect(powerUpType) {
    const effectDisplay = document.getElementById('powerup-effect-display');
    if (!effectDisplay) return;

    const powerUpEmojis = {
      'freeze_blast': ' FREEZE!',
      'shuriken_throw': ' SHURIKEN!',
      'fireball': ' FIREBALL!',
      'mega_kick': ' MEGA KICK!',
      'random_powerup': ' RANDOM!'
    };

    effectDisplay.textContent = powerUpEmojis[powerUpType] || ' POWER-UP!';
    effectDisplay.style.display = 'block';
    
    // Reset animation
    effectDisplay.style.animation = 'none';
    effectDisplay.offsetHeight; // Trigger reflow
    effectDisplay.style.animation = 'powerup-effect-flash 2.5s ease-out';
    
    setTimeout(() => {
      effectDisplay.style.display = 'none';
    }, 2500);
  }

  // Enhanced cooldown management
  function startPowerUpCooldown(powerUpType) {
    const cooldownTime = POWERUP_COOLDOWNS[powerUpType] || 5000;
    const endTime = Date.now() + cooldownTime;
    
    powerupCooldownStates[powerUpType] = {
      onCooldown: true,
      endTime: endTime
    };

    const button = document.getElementById(`${powerUpType.replace('_', '-')}-btn`);
    const overlay = document.getElementById(`${powerUpType.replace('_', '-')}-cooldown`);
    
    if (button) {
      button.classList.add('on-cooldown');
    }

    // Update cooldown display
    updateCooldownDisplay(powerUpType, cooldownTime);
  }

  // Update cooldown visual display
  function updateCooldownDisplay(powerUpType, totalTime) {
    const overlay = document.getElementById(`${powerUpType.replace('_', '-')}-cooldown`);
    const button = document.getElementById(`${powerUpType.replace('_', '-')}-btn`);
    
    if (!overlay || !button) return;

    const updateInterval = setInterval(() => {
      const now = Date.now();
      const endTime = powerupCooldownStates[powerUpType].endTime;
      const remaining = Math.max(0, endTime - now);
      const progress = 1 - (remaining / totalTime);
      
      // Update conic gradient
      overlay.style.background = `conic-gradient(from 0deg, transparent ${progress * 360}deg, rgba(0, 0, 0, 0.8) ${progress * 360}deg)`;
      
      // Show remaining time
      const remainingSeconds = Math.ceil(remaining / 1000);
      if (remainingSeconds > 0) {
        overlay.textContent = remainingSeconds;
      } else {
        overlay.textContent = '';
      }

      if (remaining <= 0) {
        clearInterval(updateInterval);
        
        // Reset cooldown state
        powerupCooldownStates[powerUpType] = { onCooldown: false, endTime: 0 };
        
        // Reset visual state
        button.classList.remove('on-cooldown');
        button.classList.add('ready');
        overlay.style.background = 'transparent';
        overlay.textContent = '';
        
        // Add ready glow effect
        setTimeout(() => {
          button.classList.remove('ready');
        }, 3000);
        
        // Show ready notification
        showPowerUpFeedback(`${powerUpType.replace('_', ' ').toUpperCase()} Ready!`, 'success');
      }
    }, 100);
  }

  // Show power-up feedback messages
  function showPowerUpFeedback(message, type = 'info') {
    const feedback = document.createElement('div');
    feedback.style.cssText = `
      position: fixed;
      top: 120px;
      right: 20px;
      background: ${type === 'error' ? 'rgba(220, 53, 69, 0.9)' : type === 'success' ? 'rgba(40, 167, 69, 0.9)' : 'rgba(255, 193, 7, 0.9)'};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 14px;
      z-index: 10001;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      border: 2px solid ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#ffc107'};
      animation: slideInRight 0.3s ease;
    `;
    
    feedback.textContent = message;
    document.body.appendChild(feedback);
    
    setTimeout(() => {
      feedback.style.animation = 'slideOutRight 0.3s ease';
      setTimeout(() => {
        if (feedback.parentNode) {
          document.body.removeChild(feedback);
        }
      }, 300);
    }, 2000);
  }

  // Show arcade mode UI when in arcade mode (enhanced)
  function showArcadeModeUI() {
    const indicator = document.getElementById('arcade-mode-indicator');
    const container = document.getElementById('powerup-container');
    
    if (indicator) {
      indicator.classList.add('visible');
    }
    if (container) {
      container.style.display = 'flex';
      
      // Add entrance animation for power-up buttons
      const buttons = container.querySelectorAll('.powerup-button');
      buttons.forEach((button, index) => {
        button.style.opacity = '0';
        button.style.transform = 'scale(0.5) translateY(20px)';
        setTimeout(() => {
          button.style.transition = 'all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
          button.style.opacity = '1';
          button.style.transform = 'scale(1) translateY(0)';
        }, index * 100);
      });
    }
    
    // Set up keyboard controls
    setupPowerupKeyboardControls();
    
    // Initialize enhanced visual effects
    initializeEnhancedPowerUpSystem();
    
    console.log(' Enhanced Arcade Mode UI activated!');
  }

  // Initialize enhanced power-up system
  function initializeEnhancedPowerUpSystem() {
    // Reset all cooldown states
    Object.keys(powerupCooldownStates).forEach(powerUp => {
      powerupCooldownStates[powerUp] = { onCooldown: false, endTime: 0 };
      
      // Reset button states
      const button = document.getElementById(`${powerUp.replace('_', '-')}-btn`);
      if (button) {
        button.classList.remove('on-cooldown', 'activating', 'ready');
        
        // Add ready glow effect for available power-ups
        setTimeout(() => {
          if (!powerupCooldownStates[powerUp].onCooldown) {
            button.classList.add('ready');
            setTimeout(() => button.classList.remove('ready'), 2000);
          }
        }, 1000);
      }
    });
    
    console.log(' Enhanced power-up system initialized');
  }

  // Hide arcade mode UI when in FIFA mode
  function hideArcadeModeUI() {
    const indicator = document.getElementById('arcade-mode-indicator');
    const container = document.getElementById('powerup-container');
    
    if (indicator) {
      indicator.classList.remove('visible');
    }
    if (container) {
      container.style.display = 'none';
    }
    
    console.log(' FIFA Mode - Power-up UI hidden');
  }

  // Set up keyboard controls for power-ups
  function setupPowerupKeyboardControls() {
    document.addEventListener('keydown', function(event) {
      // Only handle power-up keys when arcade mode UI is visible
      const container = document.getElementById('powerup-container');
      if (!container || container.style.display === 'none') {
        return;
      }

      switch(event.key) {
        case '1':
          event.preventDefault();
          activatePowerUp('freeze_blast');
          break;
        case '2':
          event.preventDefault();
          activatePowerUp('shuriken_throw');
          break;
        case '3':
          event.preventDefault();
          activatePowerUp('fireball');
          break;
        case '4':
          event.preventDefault();
          activatePowerUp('mega_kick');
          break;
        case 'f':
        case 'F':
          event.preventDefault();
          activateRandomPowerUp();
          break;
      }
    });
  }

  // Activate specific power-up (enhanced version)
  function activatePowerUp(powerUpType) {
    console.log(` Attempting to activate power-up: ${powerUpType}`);
    
    // Use the enhanced activation system
    const success = activatePowerUpWithEffects(powerUpType);
    
    if (success) {
      playUISound("button-click");
    }
  }

  // Activate random power-up (F key functionality) - enhanced version
  function activateRandomPowerUp() {
    console.log(` Attempting to activate random power-up`);
    
    // Use the enhanced activation system
    const success = activatePowerUpWithEffects('random_powerup');
    
    if (success) {
      playUISound("button-click");
    }
  }

  // Start cooldown for a power-up
  function startPowerupCooldown(powerUpType) {
    const cooldownDuration = POWERUP_COOLDOWNS[powerUpType] || 3000;
    const cooldownState = powerupCooldownStates[powerUpType];
    
    if (cooldownState) {
      cooldownState.onCooldown = true;
      cooldownState.endTime = Date.now() + cooldownDuration;
      
      // Update button visual state
      updatePowerupButtonState(powerUpType, true);
      
      // Start cooldown visual countdown
      startCooldownAnimation(powerUpType, cooldownDuration);
      
      // Clear cooldown after duration
      setTimeout(() => {
        cooldownState.onCooldown = false;
        updatePowerupButtonState(powerUpType, false);
      }, cooldownDuration);
    }
  }

  // Update power-up button visual state
  function updatePowerupButtonState(powerUpType, onCooldown) {
    const buttonId = getPowerupButtonId(powerUpType);
    const button = document.getElementById(buttonId);
    
    if (button) {
      if (onCooldown) {
        button.classList.add('on-cooldown');
      } else {
        button.classList.remove('on-cooldown');
      }
    }
  }

  // Get button ID for power-up type
  function getPowerupButtonId(powerUpType) {
    const buttonMap = {
      'freeze_blast': 'freeze-blast-btn',
      'shuriken_throw': 'shuriken-btn',
      'fireball': 'fireball-btn',
      'mega_kick': 'mega-kick-btn',
      'random_powerup': 'random-powerup-btn'
    };
    return buttonMap[powerUpType] || 'random-powerup-btn';
  }

  // Get human-readable power-up name
  function getPowerupName(powerUpType) {
    const nameMap = {
      'freeze_blast': 'Freeze Blast',
      'shuriken_throw': 'Shuriken Throw',
      'fireball': 'Fireball',
      'mega_kick': 'Mega Kick',
      'random_powerup': 'Random Power-up'
    };
    return nameMap[powerUpType] || 'Unknown Power-up';
  }

  // Start cooldown animation
  function startCooldownAnimation(powerUpType, duration) {
    const overlayId = powerUpType.replace('_', '-') + '-cooldown';
    const overlay = document.getElementById(overlayId);
    
    if (!overlay) return;
    
    let startTime = Date.now();
    
    function updateCooldown() {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const degrees = 360 * (1 - progress);
      
      overlay.style.background = `conic-gradient(from 0deg, transparent ${degrees}deg, rgba(0, 0, 0, 0.7) ${degrees}deg)`;
      
      if (progress < 1) {
        requestAnimationFrame(updateCooldown);
      } else {
        overlay.style.background = 'conic-gradient(from 0deg, transparent 0%, rgba(0, 0, 0, 0.7) 0%)';
      }
    }
    
    requestAnimationFrame(updateCooldown);
  }

  // Show power-up activation visual feedback
  function showPowerupActivation(powerUpType) {
    const buttonId = getPowerupButtonId(powerUpType);
    const button = document.getElementById(buttonId);
    
    if (button) {
      button.classList.add('activating');
      setTimeout(() => {
        button.classList.remove('activating');
      }, 600);
    }
    
    // Show center screen effect
    const effectDisplay = document.getElementById('powerup-effect-display');
    if (effectDisplay) {
      const powerupName = getPowerupName(powerUpType);
      const powerupIcon = getPowerupIcon(powerUpType);
      
      effectDisplay.textContent = `${powerupIcon} ${powerupName.toUpperCase()} ACTIVATED!`;
      effectDisplay.style.display = 'block';
      
      setTimeout(() => {
        effectDisplay.style.display = 'none';
      }, 2000);
    }
  }

  // Get power-up icon
  function getPowerupIcon(powerUpType) {
    const iconMap = {
      'freeze_blast': '',
      'shuriken_throw': '',
      'fireball': '',
      'mega_kick': '',
      'random_powerup': ''
    };
    return iconMap[powerUpType] || '';
  }

  // Enhanced powerup feedback function
  function showPowerupFeedback(data) {
    console.log("Powerup feedback received:", data);
    
    let notification = document.getElementById("powerup-notification");
    
    if (!notification) {
      notification = document.createElement('div');
      notification.id = "powerup-notification";
      notification.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        z-index: 5000;
        text-align: center;
        border: 2px solid;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      `;
      document.body.appendChild(notification);
    }
    
    // Set colors based on success
    if (data.success) {
      notification.style.borderColor = '#4CAF50';
      notification.style.background = 'rgba(76, 175, 80, 0.2)';
      notification.style.color = '#4CAF50';
    } else {
      notification.style.borderColor = '#f44336';
      notification.style.background = 'rgba(244, 67, 54, 0.2)';
      notification.style.color = '#f44336';
    }
    
    // Set message
    let message = data.message || '';
    if (data.powerUpType && data.success) {
      const icon = getPowerupIcon(data.powerUpType);
      const name = getPowerupName(data.powerUpType);
      message = `${icon} ${name.toUpperCase()} ACTIVATED!`;
    }
    
    notification.textContent = message;
    notification.style.opacity = '1';
    
    // Hide after delay
    setTimeout(() => {
      notification.style.opacity = '0';
      setTimeout(() => {
        if (notification.parentNode) {
          document.body.removeChild(notification);
        }
      }, 300);
    }, data.success ? 2000 : 3000);
  }

  // Make power-up functions globally accessible
  window.activatePowerUp = activatePowerUp;
  window.activateRandomPowerUp = activateRandomPowerUp;
  window.showArcadeModeUI = showArcadeModeUI;
  window.hideArcadeModeUI = hideArcadeModeUI;
  window.showPowerupFeedback = showPowerupFeedback;

</script>

</body>
</html>